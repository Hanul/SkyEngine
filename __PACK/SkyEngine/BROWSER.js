SkyEngine.BGM=CLASS({preset:()=>{return SOUND},params:()=>{return{isLoop:!0}},init:(e,t,n)=>{let i,o=EVENT("visibilitychange",()=>{document.hidden===!0?t.pause():t.play()});OVERRIDE(t.stop,e=>{i=t.stop=(()=>{o.remove(),e()})})}}),SkyEngine.CreateGradient=METHOD({run:e=>{let t,n=e.type,i=e.startX,o=e.startY,c=e.startRadius,a=e.endX,r=e.endY,l=e.endRadius,d=e.colors;return t="radial"===n?SkyEngine.Screen.getCanvasContext().createRadialGradient(i,o,c,a,r,l):SkyEngine.Screen.getCanvasContext().createLinearGradient(i,o,a,r),EACH(d,(e,n)=>{t.addColorStop(n/(d.length-1),e)}),t}}),SkyEngine.Delay=CLASS(e=>{let t=[];e.step=(e=>{for(let n=0;n<t.length;n+=1)t[n].step(e)});return{init:(e,n,i,o)=>{void 0===o&&(o=i,i=0);let c=0,a=(n.resume=RAR(()=>{CHECK_IS_IN({array:t,value:n})!==!0&&t.push(n)}),n.pause=(()=>{REMOVE({array:t,value:n})})),r=n.remove=(()=>{a()});n.step=(e=>{c+=e,c>=i&&(o(),r())})}}}),SkyEngine.E=CLASS({preset:()=>{return E},init:(e,t,n)=>{t.stopDefault=(()=>{n.stopDefault()}),t.stopBubbling=(()=>{n.stopBubbling()}),t.checkIsBubblingStoped=(()=>{return n.checkIsBubblingStoped()}),t.stop=(()=>{n.stop()}),t.getX=(()=>{return(n.getLeft()-WIN_WIDTH()/2)/SkyEngine.Screen.getRatio()}),t.getY=(()=>{return(n.getTop()-WIN_HEIGHT()/2)/SkyEngine.Screen.getRatio()}),t.getKey=(()=>{return n.getKey()}),t.getWheelDelta=(()=>{return n.getWheelDelta()})}}),SkyEngine.Interval=CLASS(e=>{let t=[];e.step=(e=>{for(let n=0;n<t.length;n+=1)t[n].step(e)});return{init:(e,n,i,o)=>{void 0===o&&(o=i,i=0);let c=0,a=0,r=(n.resume=RAR(()=>{CHECK_IS_IN({array:t,value:n})!==!0&&t.push(n)}),n.pause=(()=>{REMOVE({array:t,value:n})})),l=n.remove=(()=>{r()});n.step=(e=>{c+=e,c>=i&&(c-=i,a+=1,o(n,a)===!1&&l())})}}}),SkyEngine.Node=CLASS({init:(e,t,n)=>{let i,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E,y,k,m,C,w,I,Y,X,D,T,x,A,P,O,M,H,W,F,N,L,V,b,_,B,U,G,K,z,q,Z,J,j,Q,$,ee,te,ne,ie,oe,ce,ae,re,le,de,ge,fe,ue,Se,se,ve,he,Re,pe,Ee,ye=[],ke=!1,me=!1,Ce={},we=[],Ie=[],Ye=[],Xe={},De={},Te={},xe=0,Ae=BROWSER_CONFIG.SkyEngine.maxCollisionWidth,Pe=BROWSER_CONFIG.SkyEngine.maxCollisionHeight,Oe=()=>{if(void 0===le)_=i,B=o,U=i,G=o;else{let e=i*le.getRealScaleX(),t=o*le.getRealScaleY();_=le.getDrawingX()+e*le.getRealCos()-t*le.getRealSin(),B=le.getDrawingY()+e*le.getRealSin()+t*le.getRealCos();let n=a*K,c=r*z;U=_-n*J+c*Z,G=B-n*Z-c*J}},Me=t.setX=(e=>{i=e,Oe()}),He=(t.getX=(()=>{return i}),t.setY=(e=>{o=e,Oe(),ue===!0&&We(o)})),We=(t.getY=(()=>{return o}),t.setZIndex=(e=>{void 0===re?c=e:(je(),c=e,Qe())})),Fe=(t.getZIndex=(()=>{return c}),t.setPosition=(e=>{void 0!==e.x&&(i=e.x),void 0!==e.y&&(o=e.y,ue===!0&&We(o)),void 0===e.x&&void 0===e.y||Oe(),void 0!==e.zIndex&&We(e.zIndex)}),t.setCenterX=(e=>{a=e}),t.getCenterX=(()=>{return a}),t.setCenterY=(e=>{r=e}),t.getCenterY=(()=>{return r}),t.setSpeedX=(e=>{u=e,u<w&&(w=void 0),u>x&&(x=void 0)}),t.getSpeedX=(()=>{return u}),t.setSpeedY=(e=>{S=e,S<I&&(I=void 0),S>A&&(A=void 0)}),t.getSpeedY=(()=>{return S}),t.setAccelX=(e=>{p=e}),t.getAccelX=(()=>{return p}),t.setAccelY=(e=>{E=e}),t.getAccelY=(()=>{return E}),t.setMinSpeedX=(e=>{w=e}),t.getMinSpeedX=(()=>{return w}),t.setMinSpeedY=(e=>{I=e}),t.getMinSpeedY=(()=>{return I}),t.setMaxSpeedX=(e=>{x=e}),t.getMaxSpeedX=(()=>{return x}),t.setMaxSpeedY=(e=>{A=e}),t.getMaxSpeedY=(()=>{return A}),t.setToX=(e=>{W=e}),t.getToX=(()=>{return W}),t.setToY=(e=>{F=e}),t.getToY=(()=>{return F}),t.setScaleX=(e=>{l=e,K=void 0===le?l:le.getRealScaleX()*l})),Ne=(t.getScaleX=(()=>{return l}),t.setScaleY=(e=>{d=e,z=void 0===le?e:le.getRealScaleY()*d})),Le=(t.getScaleY=(()=>{return d}),t.setScale=(e=>{Fe(e),Ne(e)})),Ve=(t.setScalingSpeedX=(e=>{s=e,s<Y&&(Y=void 0),s>P&&(P=void 0)}),t.getScalingSpeedX=(()=>{return s}),t.setScalingSpeedY=(e=>{v=e,v<X&&(X=void 0),v>O&&(O=void 0)}),t.getScalingSpeedY=(()=>{return v}),t.setScalingSpeed=(e=>{s=e,v=e})),be=(t.setScalingAccelX=(e=>{y=e}),t.getScalingAccelX=(()=>{return y}),t.setScalingAccelY=(e=>{k=e}),t.getScalingAccelY=(()=>{return k}),t.setScalingAccel=(e=>{y=e,k=e})),_e=(t.setMinScalingSpeedX=(e=>{Y=e}),t.getMinScalingSpeedX=(()=>{return Y}),t.setMinScalingSpeedY=(e=>{X=e}),t.getMinScalingSpeedY=(()=>{return X}),t.setMinScalingSpeed=(e=>{Y=e,X=e}),t.setMaxScalingSpeedX=(e=>{P=e}),t.getMaxScalingSpeedX=(()=>{return P}),t.setMaxScalingSpeedY=(e=>{O=e}),t.getMaxScalingSpeedY=(()=>{return O}),t.setMaxScalingSpeed=(e=>{P=e,O=e}),t.setToScaleX=(e=>{N=e}),t.getToScaleX=(()=>{return N}),t.setToScaleY=(e=>{L=e}),t.getToScaleY=(()=>{return L}),t.setToScale=(e=>{N=e,L=e})),Be=t.setAngle=(e=>{g=e,q=void 0===le?g*Math.PI/180:le.getRealRadian()+g*Math.PI/180,Z=Math.sin(q),J=Math.cos(q)}),Ue=(t.getAngle=(()=>{return g}),t.setRotationSpeed=(e=>{h=e,h<D&&(D=void 0),h>M&&(M=void 0)}),t.getRotationSpeed=(()=>{return h}),t.setRotationAccel=(e=>{m=e}),t.getRotationAccel=(()=>{return m}),t.setMinRotationSpeed=(e=>{D=e}),t.getMinRotationSpeed=(()=>{return D}),t.setMaxRotationSpeed=(e=>{M=e}),t.getMaxRotationSpeed=(()=>{return M}),t.setToAngle=(e=>{V=e}),t.getToAngle=(()=>{return V}),t.setAlpha=(e=>{f=e}),t.getAlpha=(()=>{return f}),t.setFadingSpeed=(e=>{R=e,R<T&&(T=void 0),R>H&&(H=void 0)}),t.getFadingSpeed=(()=>{return R}),t.setFadingAccel=(e=>{C=e}),t.getFadingAccel=(()=>{return C}),t.setMinFadingSpeed=(e=>{T=e}),t.getMinFadingSpeed=(()=>{return T}),t.setMaxFadingSpeed=(e=>{H=e}),t.getMaxFadingSpeed=(()=>{return H}),t.setToAlpha=(e=>{b=e}),t.getToAlpha=(()=>{return b}),t.getDrawingX=(()=>{return U}),t.getDrawingY=(()=>{return G}),t.getRealX=(()=>{return _}),t.getRealY=(()=>{return B}),t.getRealScaleX=(()=>{return K}),t.getRealScaleY=(()=>{return z}),t.getRealRadian=(()=>{return q}),t.getRealSin=(()=>{return Z}),t.getRealCos=(()=>{return J}),t.getBeforeX=(()=>{return j}),t.getBeforeY=(()=>{return Q}),()=>{Be(g),Fe(l),Ne(d),Oe()});void 0!==n&&(i=n.x,o=n.y,a=n.centerX,r=n.centerY,c=n.zIndex,void 0!==n.scale&&Le(n.scale),void 0!==n.scaleX&&(l=n.scaleX),void 0!==n.scaleY&&(d=n.scaleY),g=n.angle,f=n.alpha,u=n.speedX,S=n.speedY,void 0!==n.scalingSpeed&&Ve(n.scalingSpeed),void 0!==n.scalingSpeedX&&(s=n.scalingSpeedX),void 0!==n.scalingSpeedY&&(v=n.scalingSpeedY),h=n.rotationSpeed,R=n.fadingSpeed,p=n.accelX,E=n.accelY,void 0!==n.scalingAccel&&be(n.scalingAccel),void 0!==n.scalingAccelX&&(y=n.scalingAccelX),void 0!==n.scalingAccelY&&(k=n.scalingAccelY),m=n.rotationAccel,C=n.fadingAccel,w=n.minSpeedX,I=n.minSpeedY,void 0!==n.minScaleSpeed&&setMinScaleSpeed(n.minScaleSpeed),void 0!==n.minScaleSpeedX&&(minScaleSpeedX=n.minScaleSpeedX),void 0!==n.minScaleSpeedY&&(minScaleSpeedY=n.minScaleSpeedY),D=n.minRotationSpeed,T=n.minFadingSpeed,x=n.maxSpeedX,A=n.maxSpeedY,void 0!==n.maxScaleSpeed&&setMaxScaleSpeed(n.maxScaleSpeed),void 0!==n.maxScaleSpeedX&&(maxScaleSpeedX=n.maxScaleSpeedX),void 0!==n.maxScaleSpeedY&&(maxScaleSpeedY=n.maxScaleSpeedY),M=n.maxRotationSpeed,H=n.maxFadingSpeed,W=n.toX,F=n.toY,void 0!==n.toScale&&_e(n.toScale),void 0!==n.toScaleX&&(N=n.toScaleX),void 0!==n.toScaleY&&(L=n.toScaleY),V=n.toAngle,b=n.toAlpha,void 0!==n.isHiding&&(ke=n.isHiding),de=n.filter,ge=n.blendMode,fe=n.isToCheckCollision,ue=n.isY2ZIndex,pe=n.onDisplayResize),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=0),void 0===u&&(u=0),void 0===S&&(S=0),void 0===p&&(p=0),void 0===E&&(E=0),void 0===l&&(l=1),void 0===d&&(d=1),void 0===s&&(s=0),void 0===v&&(v=0),void 0===y&&(y=0),void 0===k&&(k=0),void 0===g&&(g=0),void 0===h&&(h=0),void 0===m&&(m=0),void 0===f&&(f=1),void 0===R&&(R=0),void 0===C&&(C=0),void 0!==pe&&(Ee=EVENT("resize",RAR(()=>{let e=pe(WIN_WIDTH(),WIN_HEIGHT());void 0!==e.x&&Me(e.x),void 0!==e.y&&He(e.y),void 0!==e.scaleX&&Fe(e.scaleX),void 0!==e.scaleY&&Ne(e.scaleY),void 0!==e.width&&void 0!==t.setWidth&&t.setWidth(e.width),void 0!==e.height&&void 0!==t.setHeight&&t.setHeight(e.height)}))),ue===!0&&We(o),SkyEngine.Screen!==t&&SkyEngine.Screen.registerNode(t);let Ge=(t.setFilter=(e=>{de=e}),t.getFilter=(()=>{return de}),t.removeFilter=(()=>{de=void 0}),t.setBlendMode=(e=>{ge=e}),t.getBlendMode=(()=>{return ge}),t.removeBlendMode=(()=>{ge=void 0}),t.moveLeft=((e,t)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(u=-e.speed),p=void 0===e.accel?0:-e.accel,x=0,w=void 0!==e.maxSpeed?-e.maxSpeed:void 0,void 0!==e.toX&&(W=e.toX,ee=t)):(p=0,u=w=-e)})),Ke=(t.stopLeft=(e=>{void 0!==e?(p=e,x=0):u<0&&(p<0&&(p=0),u=0)}),t.moveRight=((e,t)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(u=e.speed),p=void 0===e.accel?0:e.accel,w=0,x=void 0!==e.maxSpeed?e.maxSpeed:void 0,void 0!==e.toX&&(W=e.toX,ee=t)):(p=0,u=x=e)})),ze=(t.stopRight=(e=>{void 0!==e?(p=-e,w=0):u>0&&(p>0&&(p=0),u=0)}),t.moveUp=((e,t)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=-e.speed),E=void 0===e.accel?0:-e.accel,A=0,I=void 0!==e.maxSpeed?-e.maxSpeed:void 0,void 0!==e.toY&&(F=e.toY,te=t)):(E=0,S=I=-e)})),qe=(t.stopUp=(e=>{void 0!==e?(E=e,A=0):S<0&&(E<0&&(E=0),S=0)}),t.moveDown=((e,t)=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=e.speed),E=void 0===e.accel?0:e.accel,I=0,A=void 0!==e.maxSpeed?e.maxSpeed:void 0,void 0!==e.toY&&(F=e.toY,te=t)):(E=0,S=A=e)})),Ze=(t.stopDown=(e=>{void 0!==e?(E=-e,I=0):S>0&&(E>0&&(E=0),S=0)}),t.moveTo=((e,t)=>{if(void 0===e.y)e.toX=e.x,delete e.x,e.toX<i?Ge(e,t):Ke(e,t);else if(void 0===e.x)e.toY=e.y,delete e.y,e.toY<o?ze(e,t):qe(e,t);else{W=e.x,F=e.y;let n=W-i,c=F-o,a=Math.sqrt(n*n+c*c);void 0!==e.speed&&(u=e.speed*n/a,S=e.speed*c/a),void 0!==e.accel&&(p=e.accel*n/a,E=e.accel*c/a),void 0!==e.maxSpeed&&(W<i?w=-e.maxSpeed*n/a:x=e.maxSpeed*n/a,F<o?I=-e.maxSpeed*c/a:A=e.maxSpeed*c/a),$=t}}),t.scaleTo=((e,t)=>{let n=e.speed,i=e.accel,o=(e.minSpeed,e.maxSpeed);void 0===e.y?(N=e.x,N<l?(void 0!==n&&(s=-n),void 0!==i&&(y=-i),void 0!==o&&(Y=-o)):(void 0!==n&&(s=n),void 0!==i&&(y=i),void 0!==o&&(P=o)),ie=t):void 0===e.x?(L=e.y,L<d?(void 0!==n&&(v=-n),void 0!==i&&(k=-i),void 0!==o&&(X=-o)):(void 0!==n&&(v=n),void 0!==i&&(k=i),void 0!==o&&(O=o)),oe=t):(N=e.x,N<l?(void 0!==n&&(s=-n),void 0!==i&&(y=-i),void 0!==o&&(Y=-o)):(void 0!==n&&(s=n),void 0!==i&&(y=i),void 0!==o&&(P=o)),L=e.y,L<d?(void 0!==n&&(v=-n),void 0!==i&&(k=-i),void 0!==o&&(X=-o)):(void 0!==n&&(v=n),void 0!==i&&(k=i),void 0!==o&&(O=o)),ne=t)}),t.stuckLeft=(()=>{Se=!0}),t.unstuckLeft=(()=>{Se=!1}),t.stuckRight=(()=>{se=!0}),t.unstuckRight=(()=>{se=!1}),t.stuckUp=(()=>{ve=!0}),t.unstuckUp=(()=>{ve=!1}),t.stuckDown=(()=>{he=!0}),t.unstuckDown=(()=>{he=!1}),t.rotate=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(D=e.minSpeed),void 0!==e.maxSpeed&&(M=e.maxSpeed)):h=e}),t.stopRotation=(e=>{void 0!==e?(m=-e,e>0?D=0:e<0&&(M=0)):h>0&&(h=0)}),t.rotateTo=((e,t)=>{V=e.toAngle,void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(m=e.accel),void 0!==e.minSpeed&&(D=e.minSpeed),void 0!==e.maxSpeed&&(M=e.maxSpeed),ce=t}),t.flipX=(()=>{l=-l}),t.flipY=(()=>{d=-d}),t.fadeIn=((e,t)=>{1===f&&(f=0),b=1,void 0===e?R=2:CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.maxSpeed&&(H=e.maxSpeed)):isNaN(e)===!0?(t=e,R=2):R=e,ae=t}),t.fadeOut=((e,t)=>{b=0,void 0===e?R=-2:CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(R=-e.speed),void 0!==e.accel&&(C=-e.accel),void 0!==e.maxSpeed&&(T=-e.maxSpeed)):isNaN(e)===!0?(t=e,R=-2):R=-e,ae=t}),t.stopFading=(e=>{void 0!==e?(C=-e,e>0?T=0:e<0&&(H=0)):R>0&&(R=0)}),t.fadeTo=((e,t)=>{b=e.toAlpha,void 0!==e.speed&&(R=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.minSpeed&&(T=e.minSpeed),void 0!==e.maxSpeed&&(H=e.maxSpeed),ae=t}),t.hide=(()=>{ke=!0,void 0!==Re&&Re.hide()}),t.show=(()=>{ke=!1,void 0!==Re&&Re.show()}),t.checkIsHiding=(()=>{return ke}),t.checkIsShowing=(()=>{return ke!==!0}),t.getChildren=(()=>{return ye}),t.getParent=(()=>{return re}),t.setTarget=(e=>{if(le=e,me!==!0&&void 0!==le){Ue();for(let e=0;e<Ie.length;e+=1)Ie[e].setTarget(t);for(let e=0;e<we.length;e+=1)we[e].setTarget(t);for(let e=0;e<ye.length;e+=1)ye[e].setTarget(t)}})),Je=t.setParent=(e=>{re=e,Ze(re)}),je=()=>{let e=re.getChildren(),n=0,i=e.length-1,o=0;for(;n<=i;){let a=Math.ceil((n+i)/2),r=e[a];if(r.getZIndex()<c)n=a+1;else{if(!(r.getZIndex()>c)){for(;;){if(e[a-o]===t){e.splice(a-o,1);break}if(o>0&&e[a+o]===t){e.splice(a+o,1);break}if(e[a-o].getZIndex()!==c&&e[a+o].getZIndex()!==c)break;o+=1}break}i=a-1}}},Qe=()=>{let e=re.getChildren(),n=0,i=e.length;for(;n<i;){let t=n+i>>>1;e[t].getZIndex()<=c?n=t+1:i=t}e.splice(n,0,t)},$e=(t.appendTo=(e=>{return void 0!==re&&je(),Je(e),Qe(),t}),t.append=(e=>{e.appendTo(t)}),t.empty=(()=>{for(let e=0;e<ye.length;e+=1){let t=ye[e];t.setParent(void 0),t.remove()}ye=[]}));t.remove=(()=>{nt("remove"),$e(),ye=void 0,void 0!==re&&(je(),Je(void 0)),SkyEngine.Screen!==t&&SkyEngine.Screen.unregisterNode(t),Ce=void 0;for(let e=0;e<Ie.length;e+=1)Ie[e].remove();Ie=void 0;for(let e=0;e<we.length;e+=1)we[e].remove();we=void 0,Ye=void 0,Xe=void 0,De=void 0,Te=void 0,void 0!==Re&&Re.remove(),me=!0,void 0!==Ee&&(Ee.remove(),Ee=void 0)}),t.checkIsRemoved=(()=>{return me}),t.addDom=(e=>{void 0===Re&&(Re=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),Re.append(e)});e.getDomWrapper=(()=>{return Re});let et=(t.getDomWrapper=(()=>{return void 0===Re&&(Re=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),Re}),t.addDomStyle=(e=>{void 0===Re&&(Re=DIV({style:{position:"fixed",left:-999999,top:-999999}}).appendTo(BODY)),Re.addStyle(e)}),t.removeAllDoms=(()=>{void 0!==Re&&Re.empty()}),t.on=((e,n)=>{me===!0?"remove"===e&&n(EMPTY_E(),t):(void 0===Ce[e]&&(Ce[e]=[]),Ce[e].push(n))})),tt=(t.checkIsEventExists=(e=>{return void 0!==Ce[e]}),t.off=((e,t)=>{me!==!0&&void 0!==Ce[e]&&(void 0!==t&&REMOVE({array:Ce[e],value:t}),void 0!==t&&0!==Ce[e].length||delete Ce[e])})),nt=t.fireEvent=(e=>{let n,i;CHECK_IS_DATA(e)!==!0?n=e:(n=e.eventName,i=e.e);let o=Ce[n];if(void 0!==o)for(let c=0;c<o.length;c+=1)o[c](void 0===i?EMPTY_E():i,t)}),it=(t.onMeet=((e,t)=>{Ye.push(e),void 0===De[e.id]&&(De[e.id]=[]),De[e.id].push(t),ct()}),t.offMeet=((e,t)=>{void 0===t?delete De[e.id]:REMOVE({array:De[e.id],value:t})}),t.runMeetHandlers=((e,t)=>{let n=De[e.id];if(void 0!==n)for(let i=0;i<n.length;i+=1)n[i](t)})),ot=(t.onPart=((e,t)=>{Ye.push(e),void 0===Te[e.id]&&(Te[e.id]=[]),Te[e.id].push(t)}),t.offPart=((e,t)=>{void 0===t?delete Te[e.id]:REMOVE({array:Te[e.id],value:t})}),t.runPartHandlers=((e,t)=>{let n=Te[e.id];if(void 0!==n)for(let i=0;i<n.length;i+=1)n[i](t)})),ct=(t.addTouchArea=(e=>{Ie.push(e),e.setTarget(t),e.on("remove",()=>{REMOVE({array:Ie,value:e})})}),t.getTouchAreas=(()=>{return Ie}),t.getTouchArea=(()=>{return Ie[0]}),t.addCollider=(e=>{we.push(e),e.setTarget(t),e.on("remove",()=>{REMOVE({array:we,value:e})})}),t.getColliders=(()=>{return we}),t.getCollider=(()=>{return we[0]}),t.checkPoint=((e,t)=>{for(let n=0;n<ye.length;n+=1)if(ye[n].checkPoint(e,t)===!0)return!0;return!1}),t.checkArea=(e=>{for(let t=0;t<ye.length;t+=1){let n=ye[t];if(n.checkArea(e)===!0||e.checkArea(n)===!0)return!0}return!1}),t.checkTouch=((e,n)=>{if(me===!0||t.checkIsHiding()===!0)return!1;for(let i=0;i<Ie.length;i+=1)if(Ie[i].checkPoint(e,n)===!0)return!0;for(let i=0;i<ye.length;i+=1)if(ye[i].checkTouch(e,n)===!0)return!0;return!1}),t.checkOneSideCollision=(e=>{if(me===!0||t.checkIsHiding()===!0)return!1;if(e.type===CLASS){let n=SkyEngine.Screen.findNodesByClass(e);for(let i=0;i<n.length;i+=1){let e=n[i];if(e!==t&&t.checkOneSideCollision(e)===!0)return!0}}else{if(e.checkIsHiding()===!0)return!1;for(let t=0;t<we.length;t+=1)if(e.checkIsRemoved()!==!0){let n=we[t],i=e.getColliders();for(let o=0;o<i.length;o+=1){let e=i[o];if(n.checkArea(e)===!0||e.checkArea(n)===!0)return!0}}for(let t=0;t<ye.length;t+=1)if(ye[t].checkOneSideCollision(e)===!0)return!0}return!1}),t.checkCollision=(e=>{if(e.type===CLASS){let n=SkyEngine.Screen.findNodesByClass(e);for(let i=0;i<n.length;i+=1){let e=n[i];if(e!==t&&e.checkIsRemoved()!==!0&&(t.checkOneSideCollision(e)===!0||t.type!==e.type&&e.checkOneSideCollision(t)===!0))return!0}}else if(e.checkIsRemoved()!==!0&&(t.checkOneSideCollision(e)===!0||t.type!==e.type&&e.checkOneSideCollision(t)===!0))return!0;return!1}),t.checkOffScreen=(()=>{for(let e=0;e<ye.length;e+=1)if(ye[e].checkOffScreen()!==!0)return!1;return!0}),()=>{for(let e=0;e<Ye.length;e+=1){let n=Ye[e];if(n.type===CLASS){let e=SkyEngine.Screen.findNodesByClass(n);for(let i=0;i<e.length;i+=1){let o=e[i];o!==t&&(o.checkIsRemoved()!==!0?(at()===!0||o.checkIsToCheckCollision()===!0||(void 0===Ae||Math.abs(_-o.getRealX())<Ae)&&(void 0===Pe||Math.abs(B-o.getRealY())<Pe))&&(t.checkOneSideCollision(o)===!0||t.type!==o.type&&o.checkOneSideCollision(t)===!0)?me!==!0&&(Xe[o.id]=!0,it(n,o)):me!==!0&&void 0!==Xe[o.id]&&(delete Xe[o.id],ot(n,o)):delete Xe[o.id])}}else n.checkIsRemoved()!==!0?(at()===!0||n.checkIsToCheckCollision()===!0||(void 0===Ae||Math.abs(_-n.getRealX())<Ae)&&(void 0===Pe||Math.abs(B-n.getRealY())<Pe))&&(t.checkOneSideCollision(n)===!0||t.type!==n.type&&n.checkOneSideCollision(t)===!0)?void 0===Xe[n.id]&&(Xe[n.id]=!0,it(n,n)):void 0!==Xe[n.id]&&(delete Xe[n.id],ot(n,n)):(Ye.splice(e,1),e-=1,delete Xe[n.id],delete De[n.id],delete Te[n.id]);if(void 0===Ye)break}}),at=(t.step=(e=>{if(0===xe){if(j=i,Q=o,0!==p&&(u+=p*e),void 0!==w&&u<w&&(u=w,0===u)){if(void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}if(void 0!==x&&u>x&&(u=x,0===u)){if(void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}if(0!==E&&(S+=E*e),void 0!==I&&S<I&&(S=I,0===S)){if(void 0!==te){let e=te;te=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}if(void 0!==A&&S>A&&(S=A,0===S)){if(void 0!==te){let e=te;te=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}if(0!==u){let t=u*e;if((t<0&&Se!==!0||t>0&&se!==!0)&&(i+=t,void 0!==W&&(u>0&&i>W||u<0&&i<W))){if(i=W,W=void 0,w=void 0,x=void 0,u=0,p=0,void 0!==ee){let e=ee;ee=void 0,e()}if(void 0!==$&&0===S){let e=$;$=void 0,e()}}}if(0!==S){let t=S*e;if(t<0&&ve!==!0||t>0&&he!==!0){if(o+=t,void 0!==F&&(S>0&&o>F||S<0&&o<F)){if(o=F,F=void 0,I=void 0,A=void 0,S=0,E=0,void 0!==te){let e=te;te=void 0,e()}if(void 0!==$&&0===u){let e=$;$=void 0,e()}}ue===!0&&We(o)}}if(0!==y&&(s+=y*e),void 0!==Y&&s<Y&&(s=Y),void 0!==P&&s>P&&(s=P),0!==k&&(v+=k*e),void 0!==X&&v<X&&(v=X),void 0!==O&&v>O&&(v=O),0!==s&&(l+=s*e,void 0!==N&&(s>0&&l>N||s<0&&l<N))){if(l=N,N=void 0,Y=void 0,P=void 0,s=0,y=0,void 0!==ie){let e=ie;ie=void 0,e()}if(void 0!==ne&&0===v){let e=ne;ne=void 0,e()}}if(0!==v&&(d+=v*e,void 0!==L&&(v>0&&d>L||v<0&&d<L))){if(d=L,L=void 0,X=void 0,O=void 0,v=0,k=0,void 0!==oe){let e=oe;oe=void 0,e()}if(void 0!==ne&&0===s){let e=ne;ne=void 0,e()}}if(0!==m&&(h+=m*e),void 0!==D&&h<D&&(h=D),void 0!==M&&h>M&&(h=M),0!==h){if(g+=h*e,void 0!==V&&g+V<360&&(h>0&&g>=V||h<0&&g<=V)&&(g=V,V=void 0,D=void 0,M=void 0,h=0,m=0,void 0!==ce)){let e=ce;ce=void 0,e()}g>=360?g=0:g<=0&&(g=360)}if(0!==C&&(R+=C*e),void 0!==T&&R<T&&(R=T),void 0!==H&&R>H&&(R=H),0!==R){if(f+=R*e,void 0!==b&&(R>0&&f>b||R<0&&f<b)&&(f=b,b=void 0,T=void 0,H=void 0,R=0,C=0,void 0!==ae)){let e=ae;ae=void 0,e()}f>1?f=1:f<0&&(f=0)}if(Ue(),me!==!0)for(let n=0;n<Ie.length;n+=1)Ie[n].step(e);if(me!==!0)for(let n=0;n<we.length;n+=1)we[n].step(e);if(me!==!0&&ct(),me!==!0)for(let n=0;n<ye.length&&(ye[n].step(e),void 0!==ye);n+=1);me!==!0&&void 0!==Ce.offscreen&&t.checkOffScreen()===!0&&nt("offscreen"),me!==!0&&void 0!==Ce.nextstep&&(nt("nextstep"),tt("nextstep")),me===!0||void 0===Ce.move||i===j&&o===Q||nt("move")}}),t.draw=(e=>{if(void 0!==Re){let t=SkyEngine.Screen.getRatio();Re.addStyle({left:SkyEngine.Screen.getLeft()+(SkyEngine.Screen.getWidth()/2+U-SkyEngine.Screen.getCameraFollowX())*t-Re.getWidth()/2,top:SkyEngine.Screen.getTop()+(SkyEngine.Screen.getHeight()/2+G-SkyEngine.Screen.getCameraFollowY())*t-Re.getHeight()/2,transform:"rotate("+q+"rad) scale("+t*K+", "+t*z+")",opacity:e.globalAlpha,filter:e.filter})}}),t.drawArea=(e=>{}),t.pause=(()=>{xe+=1}),t.checkIsPaused=(()=>{return xe>0}),t.resume=(()=>{xe-=1,xe<0&&(xe=0)}),t.checkIsToCheckCollision=(()=>{return fe}));t.delay=((e,t)=>{let n=SkyEngine.Delay(e,t);return et("remove",()=>{n.remove(),n=void 0}),n}),t.interval=((e,t)=>{let n=SkyEngine.Interval(e,t);return et("remove",()=>{n.remove(),n=void 0}),n});Ue()},afterInit:(e,t,n)=>{void 0!==n&&(void 0!==n.c&&(CHECK_IS_ARRAY(n.c)===!0?EACH(n.c,e=>{t.append(e)}):t.append(n.c)),void 0!==n.dom&&(CHECK_IS_ARRAY(n.dom)===!0?EACH(n.dom,e=>{t.addDom(e)}):t.addDom(n.dom)),void 0!==n.domStyle&&t.addDomStyle(n.domStyle),void 0!==n.on&&EACH(n.on,(e,n)=>{t.on(n,e)}),void 0!==n.touchArea&&(CHECK_IS_ARRAY(n.touchArea)===!0?EACH(n.touchArea,e=>{t.addTouchArea(e)}):t.addTouchArea(n.touchArea)),void 0!==n.collider&&(CHECK_IS_ARRAY(n.collider)===!0?EACH(n.collider,e=>{t.addCollider(e)}):t.addCollider(n.collider)))}}),SkyEngine.Screen=OBJECT({preset:()=>{return SkyEngine.Node},init:(e,t)=>{let n,i,o,c,a,r,l,d,g,f,u,S,s,v,h=DIV({style:{position:"fixed",left:0,top:0,zIndex:-1}}).appendTo(BODY),R=CANVAS().appendTo(h),p=R.getContext("2d"),E={},y=0,k=0,m=(t.registerNode=(e=>{let t=e.type;for(;void 0!==t&&t!==CLASS;)void 0===E[t.id]&&(E[t.id]=[]),E[t.id].push(e),t=t.mom}),t.unregisterNode=(e=>{let t=e.type;for(;void 0!==t&&t!==CLASS;){if(void 0!==E[t.id]){let n=E[t.id];for(let i=0;i<n.length;i+=1)if(n[i]===e){n.splice(i,1);break}0===E[t.id].length&&delete E[t.id]}t=t.mom}}),t.findNodesByClass=(e=>{return void 0===E[e.id]?[]:E[e.id]}));if(BROWSER_CONFIG.SkyEngine.isDebugMode===!0){let e=DIV({style:{position:"fixed",left:5,top:5,fontSize:12,zIndex:999999}}).appendTo(BODY);INTERVAL(.1,()=>{void 0!==r&&(e.empty(),e.append("FPS: "+parseInt(1/r)))})}EACH(["tap","touchstart","touchend"],e=>{R.on(e,n=>{let i,o=t=>{if(i!==!0&&(REVERSE_EACH(t.getChildren(),o),t.checkIsRemoved()!==!0&&t.checkIsEventExists(e)===!0&&t.checkTouch((n.getLeft()-WIN_WIDTH()/2)/a,(n.getTop()-WIN_HEIGHT()/2)/a)===!0)){let o=SkyEngine.E(n);t.fireEvent({eventName:e,e:o}),o.checkIsBubblingStoped()===!0&&(i=!0)}};o(t)})});let C=(e,t,n)=>{t.save(),t.translate(e.getDrawingX(),e.getDrawingY()),t.rotate(e.getRealRadian()),t.scale(e.getRealScaleX(),e.getRealScaleY()),t.lineWidth=1/(e.getRealScaleX()>e.getRealScaleY()?e.getRealScaleX():e.getRealScaleY()),t.beginPath(),e.drawArea(t),t.strokeStyle=n,t.stroke(),t.closePath(),t.restore();let i=e.getChildren();for(let o=0;o<i.length;o+=1)C(i[o],t,n)},w=(e,t,n)=>{if(e.checkIsHiding()!==!0){if(n*=e.getAlpha(),t.save(),void 0!==e.getFilter()&&(t.filter=e.getFilter()),void 0!==e.getBlendMode()&&(t.globalCompositeOperation=e.getBlendMode()),t.save(),t.translate(e.getDrawingX(),e.getDrawingY()),t.rotate(e.getRealRadian()),t.scale(e.getRealScaleX(),e.getRealScaleY()),t.globalAlpha=n,e.draw(t),t.restore(),e.checkIsRemoved()!==!0){let i=e.getChildren();for(let o=0;o<i.length;o+=1)w(i[o],t,n)}if(t.restore(),e.checkIsRemoved()!==!0&&BROWSER_CONFIG.SkyEngine.isDebugMode===!0){t.beginPath(),t.strokeStyle=t.fillStyle="aqua";let n=e.getRealX(),i=e.getRealY();t.rect(n-1,i-1,2,2),t.moveTo(n-15,i),t.lineTo(n+15,i),t.moveTo(n,i-15),t.lineTo(n,i+15),t.stroke();let o=e.getTouchAreas();for(let c=0;c<o.length;c+=1)C(o[c],t,"magenta");let a=e.getColliders();for(let c=0;c<a.length;c+=1)C(a[c],t,"lime")}}},I=LOOP(e=>{if(r=e,r>.03&&(r=.03),t.checkIsPaused()!==!0){SkyEngine.Delay.step(r),SkyEngine.Interval.step(r),t.step(r);let e=m(SkyEngine.FixedNode);for(let n=0;n<e.length;n+=1)e[n].step(0)}P.step(r),p.clearRect(0,0,o*devicePixelRatio,c*devicePixelRatio),p.save(),p.scale(devicePixelRatio,devicePixelRatio),p.translate(o/2-x(),c/2-A()),w(t,p,t.getAlpha()),p.restore()});EVENT("resize",RAR(()=>{let e=WIN_WIDTH(),t=WIN_HEIGHT();o=void 0!==BROWSER_CONFIG.SkyEngine.width?BROWSER_CONFIG.SkyEngine.width:e,c=void 0!==BROWSER_CONFIG.SkyEngine.height?BROWSER_CONFIG.SkyEngine.height:t;let r=e/o,l=t/c;a=r<l?r:l,void 0===BROWSER_CONFIG.SkyEngine.width&&(o/=a),void 0===BROWSER_CONFIG.SkyEngine.height&&(c/=a),void 0!==BROWSER_CONFIG.SkyEngine.maxWidth&&o>BROWSER_CONFIG.SkyEngine.maxWidth&&(o=BROWSER_CONFIG.SkyEngine.maxWidth),void 0!==BROWSER_CONFIG.SkyEngine.maxHeight&&c>BROWSER_CONFIG.SkyEngine.maxHeight&&(c=BROWSER_CONFIG.SkyEngine.maxHeight),R.addStyle({width:o*a,height:c*a}),n=(e-o*a)/2,i=(t-c*a)/2,h.addStyle({left:n,top:i}),R.setSize({width:o*devicePixelRatio,height:c*devicePixelRatio})})),t.on("remove",()=>{I.remove()});let Y=t.cameraFollowX=(e=>{g=e.target,l=e.centerX,void 0===l&&(l=0),u=e.minX,s=e.maxX}),X=t.cameraFollowY=(e=>{f=e.target,d=e.centerY,void 0===d&&(d=0),S=e.minY,v=e.maxY}),D=(t.cameraFollow=(e=>{Y(e),X(e)}),t.cameraUnfollowX=(()=>{g=void 0,u=void 0,s=void 0,y=0})),T=t.cameraUnfollowY=(()=>{f=void 0,S=void 0,v=void 0,k=0}),x=(t.cameraUnfollow=(()=>{D(),T()}),t.getCameraFollowX=(()=>{return void 0===g?y:g.checkIsRemoved()===!0?(g=void 0,y):(y=g.getRealX()-l,void 0!==u&&y<u?u:void 0!==s&&y>s?s:y)})),A=t.getCameraFollowY=(()=>{return void 0===f?k:f.checkIsRemoved()===!0?(f=void 0,k):(k=f.getRealY()-d,void 0!==S&&k<S?S:void 0!==v&&k>v?v:k)}),P=(t.getLeft=(()=>{return n}),t.getTop=(()=>{return i}),t.getWidth=(()=>{return o}),t.getHeight=(()=>{return c}),t.getRatio=(()=>{return a}),t.getCanvas=(()=>{return R}),t.getCanvasContext=(()=>{return p}),SkyEngine.Node());t.getNonePausableNode=(()=>{return P})}}),SkyEngine.TextBorderShadow=METHOD({run:e=>{return"1px 1px 0 "+e+",-1px 1px 0 "+e+",1px -1px 0 "+e+",-1px -1px 0 "+e+",0px 1px 0 "+e+",0px -1px 0 "+e+",-1px 0px 0 "+e+",1px 0px 0 "+e}}),SkyEngine.Figure=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i,o,c,a=n.color,r=n.border;if(void 0!==r){let e=r.split(" ");i=INTEGER(e[0]),o=e[1],c=e[2]}let l;OVERRIDE(t.draw,e=>{l=t.draw=(t=>{void 0!==a&&(t.fillStyle=a,t.fill()),void 0!==r&&(t.lineWidth=i,t.strokeStyle=c,"dashed"===o?t.setLineDash([5]):"dotted"===o&&t.setLineDash([2]),t.stroke()),t.closePath(),e(t)})});let d;OVERRIDE(t.drawArea,e=>{d=t.drawArea=(t=>{e(t)})})}}),SkyEngine.FixedNode=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i;void 0!==n&&(i=n.followScreenRatio),void 0===i&&(i=0);let o,c=0,a=0;OVERRIDE(t.step,e=>{o=t.step=(n=>{if(1!==i){let e=SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX(),n=SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY();t.setX(t.getX()+(e-c)*(1-i)/t.getRealScaleX()),t.setY(t.getY()+(n-a)*(1-i)/t.getRealScaleY()),c=e,a=n}e(n)})})}}),SkyEngine.StateSet=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i,o,c={},a=t.setStateNode=(e=>{let n=e.state,i=e.node;void 0!==c[name]&&c[name].remove(),i.hide(),t.append(i),c[n]=i});EACH(n.stateNodes,(e,t)=>{a({state:t,node:e})});let r=t.setState=((e,t)=>{void 0!==o&&(c[i].off("animationend",o),o=void 0),i=e,o=t,EACH(c,e=>{e.hide()});let n=c[i];void 0!==n&&n.show(),void 0!==o&&n.on("animationend",o)});r(n.baseState);t.getState=(()=>{return i})}}),SkyEngine.SubScreen=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i,o,c,a,r,l,d,g,f,u,S,s=n.style,v=n.width,h=n.height,R=n.isDebugMode,p=DIV({style:COMBINE([{position:"relative"},s])}),E=CANVAS().appendTo(p),y=E.getContext("2d"),k=0,m=0;if(R===!0||BROWSER_CONFIG.SkyEngine.isDebugMode===!0){let e=DIV({style:{position:"absolute",left:5,top:5,fontSize:12,zIndex:999999}}).appendTo(p);INTERVAL(.1,()=>{void 0!==c&&(e.empty(),e.append("FPS: "+parseInt(1/c)))})}EACH(["tap","touchstart","touchend"],e=>{E.on(e,n=>{let i,o=t=>{if(i!==!0&&(REVERSE_EACH(t.getChildren(),o),t.checkIsRemoved()!==!0&&t.checkIsEventExists(e)===!0&&t.checkTouch(n.getLeft()-E.getLeft()-v/2,n.getTop()-E.getTop()-h/2)===!0)){let o=SkyEngine.E(n);t.fireEvent({eventName:e,e:o}),o.checkIsBubblingStoped()===!0&&(i=!0)}};o(t)})});let C=(e,t,n)=>{t.save(),t.translate(e.getDrawingX(),e.getDrawingY()),t.rotate(e.getRealRadian()),t.scale(e.getRealScaleX(),e.getRealScaleY()),t.lineWidth=1/(e.getRealScaleX()>e.getRealScaleY()?e.getRealScaleX():e.getRealScaleY()),t.beginPath(),e.drawArea(t),t.strokeStyle=n,t.stroke(),t.closePath(),t.restore();let i=e.getChildren();for(let o=0;o<i.length;o+=1)C(i[o],t,n)},w=(e,t,n)=>{if(e.checkIsHiding()!==!0){if(n*=e.getAlpha(),t.save(),void 0!==e.getFilter()&&(t.filter=e.getFilter()),void 0!==e.getBlendMode()&&(t.globalCompositeOperation=e.getBlendMode()),t.save(),t.translate(e.getDrawingX(),e.getDrawingY()),t.rotate(e.getRealRadian()),t.scale(e.getRealScaleX(),e.getRealScaleY()),t.globalAlpha=n,e.draw(t),t.restore(),e.checkIsRemoved()!==!0){let i=e.getChildren();for(let o=0;o<i.length;o+=1)w(i[o],t,n)}if(t.restore(),e.checkIsRemoved()!==!0&&(R===!0||BROWSER_CONFIG.SkyEngine.isDebugMode===!0)){t.beginPath(),t.strokeStyle=t.fillStyle="aqua";let n=e.getRealX(),i=e.getRealY();t.rect(n-1,i-1,2,2),t.moveTo(n-15,i),t.lineTo(n+15,i),t.moveTo(n,i-15),t.lineTo(n,i+15),t.stroke();let o=e.getTouchAreas();for(let c=0;c<o.length;c+=1)C(o[c],t,"magenta");let a=e.getColliders();for(let c=0;c<a.length;c+=1)C(a[c],t,"lime")}}},I=LOOP(e=>{c=e,c>.03&&(c=.03),t.checkIsPaused()!==!0&&(SkyEngine.Delay.step(c),SkyEngine.Interval.step(c),t.step(c)),M.step(c),y.clearRect(0,0,v*devicePixelRatio,h*devicePixelRatio),y.save(),y.scale(devicePixelRatio,devicePixelRatio),y.translate(v/2-P(),h/2-O()),w(t,y,t.getAlpha()),y.restore()}),Y=t.setSize=(e=>{v=e.width,h=e.height,p.addStyle({width:v,height:h}),E.addStyle({width:v,height:h}),E.setSize({width:v*devicePixelRatio,height:h*devicePixelRatio})});Y({width:v,height:h}),t.on("remove",()=>{I.remove()});let X,D=t.cameraFollowX=(e=>{l=e.target,a=e.centerX,void 0===a&&(a=0),g=e.minX,u=e.maxX}),T=t.cameraFollowY=(e=>{d=e.target,r=e.centerY,void 0===r&&(r=0),f=e.minY,S=e.maxY}),x=(t.cameraFollow=(e=>{D(e),T(e)}),t.cameraUnfollowX=(()=>{l=void 0,g=void 0,u=void 0,k=0})),A=t.cameraUnfollowY=(()=>{d=void 0,f=void 0,S=void 0,m=0}),P=(t.cameraUnfollow=(()=>{x(),A()}),t.getCameraFollowX=(()=>{return void 0===l?k:l.checkIsRemoved()===!0?(l=void 0,k):(k=l.getRealX()-a,void 0!==g&&k<g?g:void 0!==u&&k>u?u:k)})),O=t.getCameraFollowY=(()=>{return void 0===d?m:d.checkIsRemoved()===!0?(d=void 0,m):(m=d.getRealY()-r,void 0!==f&&m<f?f:void 0!==S&&m>S?S:m)}),M=(t.getLeft=(()=>{return i}),t.getTop=(()=>{return o}),t.getWidth=(()=>{return v}),t.getHeight=(()=>{return h}),t.getCanvas=(()=>{return E}),t.getCanvasContext=(()=>{return y}),SkyEngine.Node());t.getNonePausableNode=(()=>{return M});OVERRIDE(t.appendTo,e=>{X=t.appendTo=(e=>{return p.appendTo(e),t})});let H;OVERRIDE(t.remove,e=>{H=t.remove=(()=>{e(),p.remove()})})}}),SkyEngine.Circle=CLASS(e=>{e.findRaycastPoints=((e,t,n,i,o,c,a,r,l,d)=>{let g=d*e+l*t-n,f=-l*e+d*t-i;o*=a,c*=r;let u=o/2,S=c/2,s=99999,v=(1-g*s/u/u*S*S)/f+i;s+=n;let h=-99999,R=(1-g*h/u/u*S*S)/f+i;return h+=n,SkyEngine.Line.findCircleIntersectionPoints(0,0,s,v,h,R,1,1,0,1,n,i,o,c,1,1,l,d)});return{preset:()=>{return SkyEngine.Figure},init:(t,n,i)=>{let o=i.width,c=i.height,a=SkyEngine.Util.Collision.checkPointInCircle,r=SkyEngine.Util.Collision.checkLineCircle,l=SkyEngine.Util.Collision.checkRectCircle,d=SkyEngine.Util.Collision.checkCircleCircle;n.setWidth=(e=>{o=e}),n.getWidth=(()=>{return o}),n.setHeight=(e=>{c=e}),n.getHeight=(()=>{return c});OVERRIDE(n.checkPoint,e=>{n.checkPoint=((t,i)=>{return a(t,i,n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0||e(t,i)===!0})});let g;OVERRIDE(n.checkArea,e=>{g=n.checkArea=(t=>{if(t.type===SkyEngine.Line){if(r(t.getDrawingX(),t.getDrawingY(),t.getStartX(),t.getStartY(),t.getEndX(),t.getEndY(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0}else if(t.type===SkyEngine.Rect){if(l(t.getDrawingX(),t.getDrawingY(),t.getWidth(),t.getHeight(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0}else if(t.type===SkyEngine.Circle&&d(t.getDrawingX(),t.getDrawingY(),t.getWidth(),t.getHeight(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0;return e(t)})});let f;OVERRIDE(n.checkOffScreen,e=>{
f=n.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let u;OVERRIDE(n.draw,e=>{u=n.draw=(t=>{t.beginPath(),t.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(t)})});let S;OVERRIDE(n.drawArea,e=>{S=n.drawArea=(t=>{t.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(t)})});n.findRaycastPoints=((t,i)=>{return e.findRaycastPoints(t,i,n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())})}}}),SkyEngine.Line=CLASS(e=>{let t=e.findLineIntersectionPoint=((e,t,n,i,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E)=>{if(SkyEngine.Util.Collision.checkLineLine(e,t,n,i,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E)===!0){n*=a,i*=r;let y=e+d*n+l*i,k=t+l*n+d*i;o*=a,c*=r;let m=e+d*o+l*c,C=t+l*o+d*c;u*=h,S*=R;let w=g+E*u+p*S,I=f+p*u+E*S;s*=h,v*=R;let Y=g+E*s+p*v,X=f+p*s+E*v,D=(m-y)*(X-I)-(Y-w)*(C-k);return{x:((m*k-C*y)*(Y-w)-(m-y)*(Y*I-X*w))/D,y:((m*k-C*y)*(X-I)-(C-k)*(Y*I-X*w))/D}}}),n=e.findRectIntersectionPoints=((e,n,i,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p)=>{let E=[];i*=r,o*=l;let y=e+g*i+d*o,k=n+d*i+g*o;c*=r,a*=l;let m,C,w,I,Y,X,D,T,x=e+g*c+d*a,A=n+d*c+g*a;S*=v/2,s*=h/2;let P=p*S,O=p*s,M=-R*S,H=-R*s;m=f-P-H,C=u+M-O,w=f+P-H,I=u-M-O,Y=f+P+H,X=u-M+O,D=f-P+H,T=u+M+O;let W=t(0,0,y,k,x,A,1,1,0,1,0,0,m,C,w,I,1,1,0,1);return void 0!==W&&E.push(W),W=t(0,0,y,k,x,A,1,1,0,1,0,0,w,I,Y,X,1,1,0,1),void 0!==W&&E.push(W),W=t(0,0,y,k,x,A,1,1,0,1,0,0,Y,X,D,T,1,1,0,1),void 0!==W&&E.push(W),W=t(0,0,y,k,x,A,1,1,0,1,0,0,D,T,m,C,1,1,0,1),void 0!==W&&E.push(W),E}),i=e.findCircleIntersectionPoints=((e,t,n,i,o,c,a,r,l,d,g,f,u,S,s,v,h,R)=>{let p=[];if(SkyEngine.Util.Collision.checkLineCircle(e,t,n,i,o,c,a,r,l,d,g,f,u,S,s,v,h,R)===!0){n*=a,i*=r;let E=e+d*n+l*i-g,y=t+l*n+d*i-f;o*=a,c*=r;let k=e+d*o+l*c-g,m=t+l*o+d*c-f,C=R*E+h*y,w=-h*E+R*y,I=R*k+h*m,Y=-h*k+R*m;u*=s,S*=v;let X=u/2,D=S/2,T=(Y-w)/(I-C),x=w-T*C,A=T*T*X*X+D*D,P=2*T*x*X*X,O=X*X*x*x-X*X*D*D,M=P*P-4*A*O;if(M>0){let e=(-P+Math.sqrt(M))/(2*A),t=T*e+x,n=(-P-Math.sqrt(M))/(2*A),i=T*n+x;(C<I?C:I)<=e&&e<=(C<I?I:C)&&(w<Y?w:Y)<=t&&t<=(w<Y?Y:w)&&p.push({x:R*e-h*t+g,y:h*e+R*t+f}),(C<I?C:I)<=n&&n<=(C<I?I:C)&&(w<Y?w:Y)<=i&&i<=(w<Y?Y:w)&&p.push({x:R*n-h*i+g,y:h*n+R*i+f})}else if(0===M){let e=-P/(2*A),t=T*e+x;(C<I?C:I)<=e&&e<=(C<I?I:C)&&(w<Y?w:Y)<=t&&t<=(w<Y?Y:w)&&p.push({x:R*e-h*t+g,y:h*e+R*t+f})}}return p}),o=e.findPolygonIntersectionPoints=((e,n,i,o,c,a,r,l,d,g,f,u,S,s,v,h,R)=>{let p=[];i*=r,o*=l;let E=e+g*i+d*o,y=n+d*i+g*o;c*=r,a*=l;let k=e+g*c+d*a,m=n+d*c+g*a,C=S.length;for(let w=0,I=C-1;w<C;I=w,w+=1){let e=S[w].x*s,n=S[w].y*v,i=S[I].x*s,o=S[I].y*v,c=f+R*e-h*n,a=u+h*e+R*n,r=f+R*i-h*o,l=u+h*i+R*o,d=t(0,0,E,y,k,m,1,1,0,1,0,0,c,a,r,l,1,1,0,1);void 0!==d&&p.push(d)}return p});return{preset:()=>{return SkyEngine.Figure},init:(e,c,a)=>{let r=a.startX,l=a.startY,d=a.endX,g=a.endY,f=a.isEndless,u=SkyEngine.Util.Collision.checkLineLine,S=SkyEngine.Util.Collision.checkLineRect;f===!0&&(Math.abs(d-r)<Math.abs(g-l)?(d=((g-l<0?-999999:999999)-l)/(g-l)*(d-r)+r,g=g-l<0?-999999:999999):(g=(g-l)/(d-r)*((d-r<0?-999999:999999)-r)+l,d=d-r<0?-999999:999999));let s;c.setStartX=(e=>{r=e}),c.getStartX=(()=>{return r}),c.setStartY=(e=>{l=e}),c.getStartY=(()=>{return l}),c.setEndX=(e=>{d=e}),c.getEndX=(()=>{return d}),c.setEndY=(e=>{g=e}),c.getEndY=(()=>{return g});OVERRIDE(c.checkArea,e=>{s=c.checkArea=(t=>{return t.type===SkyEngine.Line&&u(t.getDrawingX(),t.getDrawingY(),t.getStartX(),t.getStartY(),t.getEndX(),t.getEndY(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos())===!0||e(t)})});let v;OVERRIDE(c.checkOffScreen,e=>{v=c.checkOffScreen=(()=>{return S(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1)!==!0&&e()})});let h;OVERRIDE(c.draw,e=>{h=c.draw=(t=>{t.beginPath(),t.moveTo(r,l),t.lineTo(d,g),e(t)})});let R;OVERRIDE(c.drawArea,e=>{R=c.drawArea=(t=>{t.moveTo(r,l),t.lineTo(d,g),e(t)})});c.findIntersectionPoints=(e=>{let a=[];if(e.checkIsInstanceOf(SkyEngine.Line)===!0){let n=t(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getStartX(),e.getStartY(),e.getEndX(),e.getEndY(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos());void 0!==n&&a.push(n)}else e.checkIsInstanceOf(SkyEngine.Rect)===!0?a=n(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Circle)===!0?a=i(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Polygon)===!0&&(a=o(c.getDrawingX(),c.getDrawingY(),r,l,d,g,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getPoints(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()));return a})}}}),SkyEngine.Polygon=CLASS(e=>{e.findRaycastPoints=((e,t,n,i,o,c,a,r,l)=>{let d,g,f,u,S,s,v=o.length;for(let h=0;h<v;h+=1){let v=o[h].x*c,R=o[h].y*a,p=n+l*v-r*R,E=i+r*v+l*R,y=p-e,k=E-t,m=Math.acos(y/Math.sqrt(y*y+k*k));k>0&&(m=Math.PI+Math.PI-m),(void 0==d||d>m)&&(d=m,g=p,f=E),(void 0==u||u<m)&&(u=m,S=p,s=E)}return void 0===d?[]:[{x:g,y:f},{x:S,y:s}]});return{preset:()=>{return SkyEngine.Figure},init:(t,n,i)=>{let o=i.points,c=SkyEngine.Util.Collision.checkPointInPolygon,a=SkyEngine.Util.Collision.checkLinePolygon,r=SkyEngine.Util.Collision.checkRectPolygon,l=SkyEngine.Util.Collision.checkCirclePolygon,d=SkyEngine.Util.Collision.checkPolygonPolygon;n.getPoints=(()=>{return o}),n.setColor=(e=>{e=_color}),n.getColor=(()=>{return color});OVERRIDE(n.checkPoint,e=>{n.checkPoint=((t,i)=>{return c(t,i,n.getDrawingX(),n.getDrawingY(),o,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0||e(t,i)===!0})});let g;OVERRIDE(n.checkArea,e=>{g=n.checkArea=(t=>{if(t.type===SkyEngine.Line){if(a(t.getDrawingX(),t.getDrawingY(),t.getStartX(),t.getStartY(),t.getEndX(),t.getEndY(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0}else if(t.type===SkyEngine.Rect){if(r(t.getDrawingX(),t.getDrawingY(),t.getWidth(),t.getHeight(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0}else if(t.type===SkyEngine.Circle){if(l(t.getDrawingX(),t.getDrawingY(),t.getWidth(),t.getHeight(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0}else if(t.type===SkyEngine.Polygon&&d(t.getDrawingX(),t.getDrawingY(),t.getPoints(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0;return e(t)})});let f;OVERRIDE(n.checkOffScreen,e=>{f=n.checkOffScreen=(()=>{return r(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),o,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let u;OVERRIDE(n.draw,e=>{u=n.draw=(t=>{if(t.beginPath(),o.length>0){t.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let n=o[e];t.lineTo(n.x,n.y)}t.lineTo(o[0].x,o[0].y)}e(t)})});let S;OVERRIDE(n.drawArea,e=>{S=n.drawArea=(t=>{if(o.length>0){t.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let n=o[e];t.lineTo(n.x,n.y)}t.lineTo(o[0].x,o[0].y)}e(t)})});n.findRaycastPoints=((t,i)=>{return e.findRaycastPoints(t,i,n.getDrawingX(),n.getDrawingY(),o,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())})}}}),SkyEngine.Rect=CLASS(e=>{e.findRaycastPoints=((e,t,n,i,o,c,a,r,l,d)=>{let g,f,u,S,s,v,h,R;o*=a,c*=r;let p=d*o/2,E=d*c/2,y=-l*o/2,k=-l*c/2;g=n-p-k,f=i+y-E,u=n+p-k,S=i-y-E,s=n+p+k,v=i-y+E,h=n-p+k,R=i+y+E;let m=g-e,C=f-t,w=Math.acos(m/Math.sqrt(m*m+C*C));C>0&&(w=Math.PI+Math.PI-w);let I=w,Y=g,X=f,D=w,T=g,x=f;return m=u-e,C=S-t,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),I>w&&(I=w,Y=u,X=S),D<w&&(D=w,T=u,x=S),m=s-e,C=v-t,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),I>w&&(I=w,Y=s,X=v),D<w&&(D=w,T=s,x=v),m=h-e,C=R-t,w=Math.acos(m/Math.sqrt(m*m+C*C)),C>0&&(w=Math.PI+Math.PI-w),I>w&&(I=w,Y=h,X=R),D<w&&(D=w,T=h,x=R),[{x:Y,y:X},{x:T,y:x}]});return{preset:()=>{return SkyEngine.Figure},init:(t,n,i)=>{let o=i.width,c=i.height,a=SkyEngine.Util.Collision.checkPointInRect,r=SkyEngine.Util.Collision.checkLineRect,l=SkyEngine.Util.Collision.checkRectRect;n.setWidth=(e=>{o=e}),n.getWidth=(()=>{return o}),n.setHeight=(e=>{c=e}),n.getHeight=(()=>{return c}),n.setColor=(e=>{e=_color}),n.getColor=(()=>{return color});OVERRIDE(n.checkPoint,e=>{n.checkPoint=((t,i)=>{return a(t,i,n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0||e(t,i)===!0})});let d;OVERRIDE(n.checkArea,e=>{d=n.checkArea=(t=>{if(t.type===SkyEngine.Line){if(r(t.getDrawingX(),t.getDrawingY(),t.getStartX(),t.getStartY(),t.getEndX(),t.getEndY(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0}else if(t.type===SkyEngine.Rect&&l(t.getDrawingX(),t.getDrawingY(),t.getWidth(),t.getHeight(),t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos(),n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())===!0)return!0;return e(t)})});let g;OVERRIDE(n.checkOffScreen,e=>{g=n.checkOffScreen=(()=>{return l(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e()})});let f;OVERRIDE(n.draw,e=>{f=n.draw=(t=>{t.beginPath(),t.rect(-o/2,-c/2,o,c),e(t)})});let u;OVERRIDE(n.drawArea,e=>{u=n.drawArea=(t=>{t.rect(-o/2,-c/2,o,c),e(t)})});n.findRaycastPoints=((t,i)=>{return e.findRaycastPoints(t,i,n.getDrawingX(),n.getDrawingY(),o,c,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())})}}}),SkyEngine.Background=CLASS({preset:()=>{return SkyEngine.FixedNode},init:(e,t,n)=>{let i=n.src,o=n.isNotToRepeatX,c=n.isNotToRepeatY,a=n.leftMargin,r=n.rightMargin,l=n.topMargin,d=n.bottomMargin;void 0===a&&(a=0),void 0===r&&(r=0),void 0===l&&(l=0),void 0===d&&(d=0);let g,f,u=new Image;u.onload=(()=>{g=u.width,f=u.height,u.onload=void 0,t.fireEvent("load")}),u.src=i;let S;OVERRIDE(t.draw,e=>{S=t.draw=(n=>{if(void 0!==g)if(o===!0&&c===!0)n.drawImage(u,-g/2,-f/2,g,f);else if(o===!0){let e=-f/2,i=(SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY())/SkyEngine.Screen.getRealScaleY()/t.getRealScaleY(),o=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/t.getRealScaleY();for(;i-o<e+t.getY();)e-=l+f+d;for(;e+t.getY()<i+o;)n.drawImage(u,-g/2,e,g,f),e+=l+f+d}else if(c===!0){let e=-g/2,i=(SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX())/SkyEngine.Screen.getRealScaleX()/t.getRealScaleX(),o=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/t.getRealScaleX();for(;i-o<e+t.getX();)e-=a+g+r;for(;e+t.getX()<i+o;)n.drawImage(u,e,-f/2,g,f),e+=a+g+r}else{let e=-g/2,i=-f/2,o=(SkyEngine.Screen.getCameraFollowX()-SkyEngine.Screen.getX())/SkyEngine.Screen.getRealScaleX()/t.getRealScaleX(),c=(SkyEngine.Screen.getCameraFollowY()-SkyEngine.Screen.getY())/SkyEngine.Screen.getRealScaleY()/t.getRealScaleY(),S=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/t.getRealScaleX(),s=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/t.getRealScaleY();for(;o-S<e+t.getX();)e-=a+g+r;for(;c-s<i+t.getY();)i-=l+f+d;for(;i+t.getY()<c+s;){let c=e;for(;c+t.getX()<o+S;)n.drawImage(u,c,i,g,f),c+=a+g+r;i+=l+f+d}}e(n)})});let s;OVERRIDE(t.remove,e=>{s=t.remove=(()=>{u.onload=void 0,u=void 0,e()})});e.getImg=(()=>{return u})}}),SkyEngine.Image=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i=n.src,o=n.cropTop,c=n.cropRight,a=n.cropBottom,r=n.cropLeft;void 0===o&&(o=0),void 0===c&&(c=0),void 0===a&&(a=0),void 0===r&&(r=0);let l,d,g,f,u,S=SkyEngine.Util.Collision.checkRectRect,s=!1,v=t.setSrc=(e=>{i=e;let n=new Image;void 0===u&&(u=n),n.onload=(()=>{g=n.width,f=n.height,n.onload=void 0,u=n,t.fireEvent("load")}),n.src=i});v(i);let h;OVERRIDE(t.checkPoint,e=>{h=t.checkPoint=((n,o)=>{if(void 0===l){if(s!==!0){let e=new Image;e.onload=(()=>{let t=e.width,n=e.height,i=CANVAS({style:{display:"none"},width:t,height:n}).appendTo(BODY),o=i.getContext("2d");o.drawImage(e,0,0,t,n),l=o.getImageData(0,0,t,n).data,o=void 0,i.remove(),e.onload=void 0}),e.src=i,s=!0}return e(n,o)===!0}let c=n-t.getDrawingX(),a=o-t.getDrawingY(),r=Math.cos(-t.getRealRadian()),d=Math.sin(-t.getRealRadian()),u=r*c-d*a,S=r*a+d*c;return u=parseInt((u+g*t.getRealScaleX()/2)/t.getRealScaleX()),S=parseInt((S+f*t.getRealScaleY()/2)/t.getRealScaleY()),u>=0&&u<g&&S>=0&&S<f&&l[4*(S*g+u)+3]>20||e(n,o)===!0})});let R;OVERRIDE(t.checkOffScreen,e=>{R=t.checkOffScreen=(()=>{return void 0!==g&&S(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),g,f,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let p;OVERRIDE(t.draw,e=>{p=t.draw=(t=>{let n=g-r-c,i=f-o-a;n>0&&i>0&&t.drawImage(u,r,o,n,i,-g/2+r,-f/2+o,n,i),e(t)})});let E;OVERRIDE(t.drawArea,e=>{E=t.drawArea=(t=>{if(void 0===d)if(void 0===l){if(s!==!0){let e=new Image;e.onload=(()=>{let t=e.width,n=e.height,i=CANVAS({style:{display:"none"},width:t,height:n}).appendTo(BODY),o=i.getContext("2d");o.drawImage(e,0,0,t,n),l=o.getImageData(0,0,t,n).data,d=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(l,t),o=void 0,i.remove(),e.onload=void 0}),e.src=i,s=!0}}else d=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(l,g);else if(d.length>0){t.moveTo(d[0].x-g/2,d[0].y-f/2);for(let e=1;e<d.length;e+=1){let n=d[e];t.lineTo(n.x-g/2,n.y-f/2)}t.lineTo(d[0].x-g/2,d[0].y-f/2)}e(t)})});let y;OVERRIDE(t.remove,e=>{y=t.remove=(()=>{u.onload=void 0,u=void 0,l=void 0,d=void 0,e()})});e.getImg=(()=>{return u}),t.crop=(e=>{void 0!==e.top&&(o=e.top),void 0!==e.right&&(c=e.right),void 0!==e.bottom&&(a=e.bottom),void 0!==e.left&&(r=e.left)})}}}),SkyEngine.Silhouette=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i,o,c,a=n.src,r=n.color,l=n.border,d=n.width,g=n.height,f=SkyEngine.Util.Collision.checkRectRect;if(void 0!==l){let e=l.split(" ");i=INTEGER(e[0]),o=e[1],c=e[2]}let u,S,s,v=t.setSrc=(e=>{a=e,u=new Image,u.onload=(()=>{void 0===d&&(d=u.width),void 0===g&&(g=u.height);let e=CANVAS({style:{display:"none"},width:d,height:g}).appendTo(BODY),n=e.getContext("2d");n.drawImage(u,0,0,u.width,u.height);let i=n.getImageData(0,0,d,g);S=i.data;let o,c=S.length;for(o=0;o<c;o+=4)S[o]=0,S[o+1]=0,S[o+2]=0;u.onload=void 0,n.clearRect(0,0,d,g),n.putImageData(i,0,0),n.globalCompositeOperation="source-in",n.rect(0,0,d,g),n.fillStyle=r,n.fill(),u.src=e.getEl().toDataURL(),i=void 0,n=void 0,e.remove(),void 0!==l&&(s=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(S,d)),t.fireEvent("load")}),u.src=a});v(a);let h;OVERRIDE(t.checkPoint,e=>{h=t.checkPoint=((n,i)=>{if(void 0===S)return e(n,i)===!0;let o=n-t.getDrawingX(),c=i-t.getDrawingY(),a=Math.cos(-t.getRealRadian()),r=Math.sin(-t.getRealRadian()),l=a*o-r*c,f=a*c+r*o;return l=parseInt((l+d*t.getRealScaleX()/2)/t.getRealScaleX()),f=parseInt((f+g*t.getRealScaleY()/2)/t.getRealScaleY()),l>=0&&l<d&&f>=0&&f<g&&S[4*(f*d+l)+3]>20||e(n,i)===!0})});let R;OVERRIDE(t.checkOffScreen,e=>{R=t.checkOffScreen=(()=>{return void 0!==d&&f(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),d,g,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let p;OVERRIDE(t.draw,e=>{p=t.draw=(t=>{if(void 0!==S&&(void 0!==r&&t.drawImage(u,-d/2,-g/2,d,g),void 0!==l&&s.length>0)){t.beginPath(),t.moveTo(s[0].x-d/2,s[0].y-g/2);for(let e=1;e<s.length;e+=1){let n=s[e];t.lineTo(n.x-d/2,n.y-g/2)}t.lineTo(s[0].x-d/2,s[0].y-g/2),t.lineWidth=i,t.strokeStyle=c,"dashed"===o?t.setLineDash([5]):"dotted"===o&&t.setLineDash([2]),t.stroke(),t.closePath()}e(t)})});let E;OVERRIDE(t.drawArea,e=>{E=t.drawArea=(t=>{if(void 0===s)void 0!==S&&(s=SkyEngine.Util.ImageData.convertImageDataToPolygonPoints(S,d));else if(s.length>0){t.moveTo(s[0].x-d/2,s[0].y-g/2);for(let e=1;e<s.length;e+=1){let n=s[e];t.lineTo(n.x-d/2,n.y-g/2)}t.lineTo(s[0].x-d/2,s[0].y-g/2)}e(t)})});let y;OVERRIDE(t.remove,e=>{y=t.remove=(()=>{u.onload=void 0,u=void 0,S=void 0,s=void 0,e()})});e.getImg=(()=>{return u}),e.getPolygonPoints=(()=>{return s})}}}),SkyEngine.Sprite=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i,o,c,a,r=n.src,l=n.srcs,d=n.spriteWidth,g=n.spriteHeight,f=n.fps,u=n.frameCount,S=SkyEngine.Util.Collision.checkRectRect,s=0,v=0,h=0,R=!1;void 0===f&&(f=0),void 0!==r&&(i=new Image,i.onload=(()=>{c=i.width,a=i.height,void 0===d&&(d=void 0!==u?c/u:c),void 0===g&&(g=a),void 0===u&&(u=c/d*a/g),i.onload=void 0,t.fireEvent("load")}),i.src=r),void 0!==l&&EACH(l,e=>{let n=new Image;void 0===o&&(o=[]),n.onload=(()=>{c=n.width,a=n.height,void 0===d&&(d=c),void 0===g&&(g=a),void 0===u?u=1:u+=1,n.onload=void 0,t.fireEvent("load")}),n.src=e,o.push(n)});let p,E=(t.getFrame=(()=>{return v}),t.getBeforeFrame=(()=>{return h}),t.stop=(()=>{R=!0})),y=t.resume=(()=>{R=!1});OVERRIDE(t.hide,e=>{p=t.hide=(()=>{s=0,v=0,h=0,E(),e()})});let k;OVERRIDE(t.show,e=>{k=t.show=(()=>{s=0,v=0,h=0,y(),e()})});let m;OVERRIDE(t.checkOffScreen,e=>{m=t.checkOffScreen=(()=>{return void 0!==c&&S(SkyEngine.Screen.getCameraFollowX(),SkyEngine.Screen.getCameraFollowY(),SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),d,g,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e()})});let C;OVERRIDE(t.step,e=>{C=t.step=(n=>{R!==!0&&(f>0&&(s+=f*n),void 0!==u&&s>=u&&(s-=u,t.fireEvent("animationend")),h=v,v=Math.floor(s),v!==h&&t.checkIsRemoved()!==!0&&t.fireEvent("framechange")),e(n)})});let w;OVERRIDE(t.draw,e=>{w=t.draw=(t=>{if(void 0!==o){if(void 0!==u){let e=o[v];void 0!==e&&t.drawImage(e,-c/2,-a/2,c,a)}}else void 0!==c&&void 0!==a&&void 0!==d&&void 0!==g&&t.drawImage(i,d*Math.floor(s%(c/d)),g*Math.floor(s/(c/d)),d,g,-d/2,-g/2,d,g);e(t)})});let I;OVERRIDE(t.remove,e=>{I=t.remove=(()=>{l=void 0,void 0!==i&&(i.onload=void 0,i=void 0),EACH(o,e=>{e.onload=void 0}),o=void 0,e()})});e.getImg=(()=>{return i}),e.getImgs=(()=>{return o}),e.getRealFrame=(()=>{return s}),t.getSpriteWidth=(()=>{return d}),t.getSpriteHeight=(()=>{return g})}}),SkyEngine.ParticleSystem=CLASS(()=>{let e=(e,t)=>{return Math.random()*(t-e)+e};return{preset:()=>{return SkyEngine.Node},init:(t,n,i)=>{let o,c,a=i.particleSrc,r=i.particleFigure,l=i.particleStartX,d=i.particleStartY,g=i.particleEndX,f=i.particleEndY,u=i.particleWidth,S=i.particleHeight,s=i.particlePoints,v=i.particleColor,h=i.particleBorder,R=i.particleColorR,p=i.minParticleColorR,E=i.maxParticleColorR,y=i.particleColorG,k=i.minParticleColorG,m=i.maxParticleColorG,C=i.particleColorB,w=i.minParticleColorB,I=i.maxParticleColorB,Y=i.particleCenterX,X=i.particleCenterY,D=i.particleCount,T=i.minParticleCount,x=i.maxParticleCount,A=i.particleX,P=i.minParticleX,O=i.maxParticleX,M=i.particleY,H=i.minParticleY,W=i.maxParticleY,F=i.particleLifetime,N=i.minParticleLifetime,L=i.maxParticleLifetime,V=i.particleDirection,b=i.minParticleDirection,_=i.maxParticleDirection,B=i.particleSpeed,U=i.minParticleSpeed,G=i.maxParticleSpeed,K=i.particleAccel,z=i.particleAccelX,q=i.particleAccelY,Z=i.minParticleAccel,J=i.maxParticleAccel,j=i.particleScale,Q=i.minParticleScale,$=i.maxParticleScale,ee=i.particleScalingSpeed,te=i.minParticleScalingSpeed,ne=i.maxParticleScalingSpeed,ie=i.isParticleAngleToDirection,oe=i.particleAngle,ce=i.minParticleAngle,ae=i.maxParticleAngle,re=i.particleRotationSpeed,le=i.minParticleRotationSpeed,de=i.maxParticleRotationSpeed,ge=i.particleAlpha,fe=i.minParticleAlpha,ue=i.maxParticleAlpha,Se=i.particleFadingSpeed,se=i.minParticleFadingSpeed,ve=i.maxParticleFadingSpeed,he=i.particleFadingAccel;void 0===R&&(R=0),void 0===p&&(p=R),void 0===E&&(E=R),void 0===y&&(y=0),void 0===k&&(k=y),void 0===m&&(m=y),void 0===C&&(C=0),void 0===w&&(w=C),void 0===I&&(I=C),void 0===Y&&(Y=0),void 0===X&&(X=0),void 0===D&&(D=1),void 0===T&&(T=D),void 0===x&&(x=D),void 0===A&&(A=0),void 0===P&&(P=A),void 0===O&&(O=A),void 0===M&&(M=0),void 0===H&&(H=M),void 0===W&&(W=M),void 0===N&&(N=F),void 0===L&&(L=F),void 0===b&&(b=V),void 0===_&&(_=V),void 0===U&&(U=B),void 0===G&&(G=B),void 0===z&&(z=0),void 0===q&&(q=0),void 0===K&&(K=0),void 0===Z&&(Z=K),void 0===J&&(J=K),void 0===j&&(j=1),void 0===Q&&(Q=j),void 0===$&&($=j),void 0===ee&&(ee=0),void 0===te&&(te=ee),void 0===ne&&(ne=ee),void 0===oe&&(oe=0),void 0===ce&&(ce=oe),void 0===ae&&(ae=oe),void 0===re&&(re=0),void 0===le&&(le=re),o=le*Math.PI/180,void 0===de&&(de=re),c=de*Math.PI/180,void 0===ge&&(ge=1),void 0===fe&&(fe=ge),void 0===ue&&(ue=ge),void 0===Se&&(Se=0),void 0===se&&(se=Se),void 0===ve&&(ve=Se);let Re,pe,Ee;if(void 0!==h){let e=h.split(" ");Re=INTEGER(e[0]),pe=e[1],Ee=e[2]}let ye,ke,me;void 0!==a?(me=new Image,me.onload=(()=>{ye=me.width,void 0===u&&(u=ye),ke=me.height,void 0===S&&(S=ke),me.onload=void 0,n.fireEvent("load")}),me.src=a):n.fireEvent("load");let Ce,we,Ie=[];n.burst=(t=>{Ce=t,REPEAT(e(T,x),()=>{let t=e(b,_)*Math.PI/180,n=Math.sin(t),i=Math.cos(t),a=e(U,G),l=e(Z,J),d={time:0,lifetime:e(N,L),x:e(P,O),y:e(H,W),scalingSpeed:e(te,ne),direction:t,speedX:a*i,speedY:a*n,accelX:l*i,accelY:l*n,scale:e(Q,$),rotationSpeedRadian:e(o,c),radian:e(ce,ae)*Math.PI/180,fadingSpeed:e(se,ve),alpha:e(fe,ue)};void 0!==r&&void 0===v&&(d.color="rgb("+RANDOM({min:p,max:E})+", "+RANDOM({min:k,max:m})+", "+RANDOM({min:w,max:I})+")"),Ie.push(d)})});OVERRIDE(n.step,e=>{we=n.step=(t=>{for(let i=0;i<Ie.length;i+=1){let e=Ie[i];if(e.time+=t,e.time>e.lifetime?(Ie.splice(i,1),void 0!==Ce&&0===Ie.length&&Ce(n)):(e.speedX+=z*t,e.speedY+=q*t,e.speedX+=e.accelX*t,e.speedY+=e.accelY*t,e.x+=e.speedX*t,e.y+=e.speedY*t,e.scale+=e.scalingSpeed*t,e.scale<0&&(e.scale=0),e.radian+=e.rotationSpeedRadian*t,e.alpha+=e.fadingSpeed*t,void 0!==he&&(e.fadingSpeed+=he*t),e.alpha<0&&(e.alpha=0)),void 0===Ie)break}e(t)})});let Ye;OVERRIDE(n.draw,e=>{Ye=n.draw=(t=>{for(let n=0;n<Ie.length;n+=1){let e=Ie[n],i=e.scale;if(t.save(),t.translate(e.x,e.y),ie===!0?t.rotate(e.direction):t.rotate(e.radian),t.scale(i,i),t.globalAlpha*=e.alpha,void 0===r)t.drawImage(me,Y-ye/2,X-ke/2,ye,ke);else{if(t.beginPath(),"line"===r)t.moveTo(Y+l,X+d),t.lineTo(Y+g,X+f);else if("rect"===r)t.rect(Y-u/2,Y-S/2,u,S);else if("circle"===r)t.ellipse(Y,X,u/2,S/2,0,0,2*Math.PI);else if("polygon"===r&&s.length>0){t.moveTo(Y+s[0].x,X+s[0].y);for(let e=1;e<s.length;e+=1){let n=s[e];t.lineTo(Y+n.x,X+n.y)}t.lineTo(Y+s[0].x,X+s[0].y)}void 0!==v?(t.fillStyle=v,t.fill()):void 0!==e.color&&(t.fillStyle=e.color,t.fill()),void 0!==h&&(t.lineWidth=Re,t.strokeStyle=Ee,"dashed"===pe?t.setLineDash([5]):"dotted"===pe&&t.setLineDash([2]),t.stroke()),t.closePath()}t.restore()}e(t)})});let Xe;OVERRIDE(n.remove,e=>{Xe=n.remove=(()=>{void 0!==me&&(me.onload=void 0,me=void 0),Ie=void 0,e()})})}}}),SkyEngine.ParticleSystemOnce=CLASS({preset:()=>{return SkyEngine.ParticleSystem},init:(e,t,n)=>{t.burst(e=>{e.remove()})}}),SkyEngine.CollisionTile=CLASS({preset:()=>{return SkyEngine.Tile}}),SkyEngine.HexagonTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,t,n)=>{let i,o=n.overlapHeight;OVERRIDE(t.addTile,n=>{i=t.addTile=(n=>{let i=n.row,c=n.col,a=e.createTile(n);void 0!==a&&(a.setPosition({x:c*t.getTileWidth()+i%2*t.getTileWidth()/2,y:i*(t.getTileHeight()-o)}),a.checkIsInstanceOf(SkyEngine.CollisionTile)===!0&&a.addCollider(SkyEngine.Polygon({points:[{x:0,y:-t.getTileHeight()/2},{x:t.getTileWidth()/2,y:-t.getTileHeight()/4},{x:t.getTileWidth()/2,y:t.getTileHeight()/4},{x:0,y:t.getTileHeight()/2},{x:-t.getTileWidth()/2,y:t.getTileHeight()/4},{x:-t.getTileWidth()/2,y:-t.getTileHeight()/4}]})))})});let c;OVERRIDE(t.moveTile,n=>{c=t.moveTile=((n,i)=>{let c=n.fromRow,a=n.fromCol,r=n.toRow,l=n.toCol,d=n.speed,g=n.accel,f=e.swapTile(n),u=f.fromTile,S=f.toTile;void 0!==u&&(void 0!==d||void 0!==g?(u.moveTo({x:l*t.getTileWidth()+r%2*t.getTileWidth()/2,y:r*(t.getTileHeight()-o),speed:d,accel:g},i),i=void 0):u.setPosition({x:l*t.getTileWidth()+r%2*t.getTileWidth()/2,y:r*(t.getTileHeight()-o)})),void 0!==S&&(void 0!==d||void 0!==g?(S.moveTo({x:a*t.getTileWidth()+c%2*t.getTileWidth()/2,y:c*(t.getTileHeight()-o),speed:d,accel:g},i),i=void 0):S.setPosition({x:a*t.getTileWidth()+c%2*t.getTileWidth()/2,y:c*(t.getTileHeight()-o)}))})});let a;OVERRIDE(t.findPath,e=>{a=t.findPath=(e=>{let n=e.startRow,i=e.startCol,o=e.endRow,c=e.endCol,a=[],r=[],l=(e,n,i)=>{if(void 0!==t.getTile({row:n,col:i})&&t.checkCollisionTile({row:n,col:i})!==!0){void 0===a[n]&&(a[n]=[]);let t=e.cost+1;(void 0===a[n][i]||a[n][i]>t)&&(a[n][i]=t,r.push({parent:e,row:n,col:i,cost:t}))}};for(l({cost:-1},n,i);r.length>0;){let e=r.shift();if(e.row===o&&e.col===c){let t=[],n=e;for(;n.cost>=0;)t.unshift({row:n.row,col:n.col}),n=n.parent;return t}e.row%2===0?(l(e,e.row-1,e.col-1),l(e,e.row-1,e.col),l(e,e.row,e.col+1),l(e,e.row+1,e.col),l(e,e.row+1,e.col-1),l(e,e.row,e.col-1)):(l(e,e.row-1,e.col),l(e,e.row-1,e.col+1),l(e,e.row,e.col+1),l(e,e.row+1,e.col+1),l(e,e.row+1,e.col),l(e,e.row,e.col-1))}})})}}),SkyEngine.IsometricTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,t,n)=>{let i;OVERRIDE(t.addTile,n=>{i=t.addTile=(n=>{let i=n.row,o=n.col,c=e.createTile(n);void 0!==c&&(c.setPosition({x:o*t.getTileWidth()+i%2*t.getTileWidth()/2,y:i*t.getTileHeight()/2}),c.checkIsInstanceOf(SkyEngine.CollisionTile)===!0&&c.addCollider(SkyEngine.Polygon({points:[{x:0,y:-t.getTileHeight()/2},{x:t.getTileWidth()/2,y:0},{x:0,y:t.getTileHeight()/2},{x:-t.getTileWidth()/2,y:0}]})))})});let o;OVERRIDE(t.moveTile,n=>{o=t.moveTile=((n,i)=>{let o=n.fromRow,c=n.fromCol,a=n.toRow,r=n.toCol,l=n.speed,d=n.accel,g=e.swapTile(n),f=g.fromTile,u=g.toTile;void 0!==f&&(void 0!==l||void 0!==d?(f.moveTo({x:r*t.getTileWidth()+a%2*t.getTileWidth()/2,y:a*t.getTileHeight()/2,speed:l,accel:d},i),i=void 0):f.setPosition({x:r*t.getTileWidth()+a%2*t.getTileWidth()/2,y:a*t.getTileHeight()/2})),void 0!==u&&(void 0!==l||void 0!==d?(u.moveTo({x:c*t.getTileWidth()+o%2*t.getTileWidth()/2,y:o*t.getTileHeight()/2,speed:l,accel:d},i),i=void 0):u.setPosition({x:c*t.getTileWidth()+o%2*t.getTileWidth()/2,y:o*t.getTileHeight()/2}))})});let c;OVERRIDE(t.findPath,e=>{c=t.findPath=(e=>{let n=e.startRow,i=e.startCol,o=e.endRow,c=e.endCol,a=[],r=[],l=(e,n,i)=>{if(void 0!==t.getTile({row:n,col:i})&&t.checkCollisionTile({row:n,col:i})!==!0){void 0===a[n]&&(a[n]=[]);let t=e.cost+1;(void 0===a[n][i]||a[n][i]>t)&&(a[n][i]=t,r.push({parent:e,row:n,col:i,cost:t}))}};for(l({cost:-1},n,i);r.length>0;){let e=r.shift();if(e.row===o&&e.col===c){let t=[],n=e;for(;n.cost>=0;)t.unshift({row:n.row,col:n.col}),n=n.parent;return t}e.row%2===0?(l(e,e.row-1,e.col-1),l(e,e.row-1,e.col),l(e,e.row+1,e.col-1),l(e,e.row+1,e.col)):(l(e,e.row-1,e.col),l(e,e.row-1,e.col+1),l(e,e.row+1,e.col),l(e,e.row+1,e.col+1))}})})}}),SkyEngine.Tile=CLASS({preset:()=>{return SkyEngine.Node}}),SkyEngine.TileMap=CLASS({preset:()=>{return SkyEngine.Node},init:(e,t,n)=>{let i=n.tileWidth,o=n.tileHeight,c=n.tileSet,a=n.tileKeyMap;void 0===c&&(c={}),void 0===a&&(a=[]);let r,l=[],d=(t.getTileWidth=(()=>{return i}),t.getTileHeight=(()=>{return o}),e.createTile=(e=>{let n=e.row,i=e.col,o=e.tile,r=e.key;return void 0!==r&&void 0!==c[r]&&(o=c[r](n,i),void 0===a[n]&&(a[n]=[]),a[n][i]=r),void 0!==o&&(t.append(o),void 0===l[n]&&(l[n]=[]),l[n][i]=o),o})),g=(t.addTile=(e=>{let t=e.row,n=e.col,c=d(e);void 0!==c&&(c.setPosition({x:n*i,y:t*o}),c.checkIsInstanceOf(SkyEngine.CollisionTile)===!0&&c.addCollider(SkyEngine.Rect({width:i,height:o})))}),t.getTileKey=(e=>{let t=e.row,n=e.col;if(void 0!==a&&void 0!==a[t])return a[t][n]}),t.getTile=(e=>{let t=e.row,n=e.col;if(void 0!==l[t])return l[t][n]})),f=e.swapTile=(e=>{let t,n=e.fromRow,i=e.fromCol,o=e.toRow,c=e.toCol;void 0===a[o]?a[o]=[]:t=a[o][c],void 0===a[n]?a[n]=[]:a[o][c]=a[n][i],a[n][i]=t;let r;void 0!==l[n]&&(r=l[n][i]);let d;return void 0!==l[o]&&(d=l[o][c]),void 0===l[o]&&(l[o]=[]),l[o][c]=r,void 0===d?void 0!==l[n]&&(l[n][i]=void 0):(void 0===l[n]&&(l[n]=[]),l[n][i]=d),{fromTile:r,toTile:d}});t.moveTile=((e,t)=>{let n=e.fromRow,c=e.fromCol,a=e.toRow,r=e.toCol,l=e.speed,d=e.accel,g=f(e),u=g.fromTile,S=g.toTile;void 0!==u&&(void 0!==l||void 0!==d?(u.moveTo({x:r*i,y:a*o,speed:l,accel:d},t),t=void 0):u.setPosition({x:r*i,y:a*o})),void 0!==S&&(void 0!==l||void 0!==d?(S.moveTo({x:c*i,y:n*o,speed:l,accel:d},t),t=void 0):S.setPosition({x:c*i,y:n*o}))}),t.removeTile=(e=>{let t=e.row,n=e.col;void 0!==a[t]&&(a[t][n]=void 0),void 0!==l[t]&&void 0!==l[t][n]&&(l[t][n].remove(),l[t][n]=void 0)});OVERRIDE(t.empty,e=>{r=t.empty=(()=>{a=[],l=[],e()})});let u=t.checkCollisionTile=(e=>{let t=e.row,n=e.col;return void 0!==l[t]&&void 0!==l[t][n]&&l[t][n].checkIsInstanceOf(SkyEngine.CollisionTile)===!0});t.findPath=(e=>{let t=e.startRow,n=e.startCol,i=e.endRow,o=e.endCol,c=[],a=[],r=(e,t,n)=>{if(void 0!==g({row:t,col:n})&&u({row:t,col:n})!==!0){void 0===c[t]&&(c[t]=[]);let i=e.cost+1;(void 0===c[t][n]||c[t][n]>i)&&(c[t][n]=i,a.push({parent:e,row:t,col:n,cost:i}))}};for(r({cost:-1},t,n);a.length>0;){let e=a.shift();if(e.row===i&&e.col===o){let t=[],n=e;for(;n.cost>=0;)t.unshift({row:n.row,col:n.col}),n=n.parent;return t}r(e,e.row-1,e.col),r(e,e.row,e.col+1),r(e,e.row+1,e.col),r(e,e.row,e.col-1)}})},afterInit:(e,t,n)=>{let i=n.tileMap,o=n.tileKeyMap;void 0!==i&&(EACH(i,(e,n)=>{EACH(e,(e,i)=>{void 0!==e&&t.addTile({row:n,col:i,tile:e})})}),i=void 0),void 0!==o&&EACH(o,(e,n)=>{EACH(e,(e,i)=>{t.addTile({row:n,col:i,key:e})})})}}),SkyEngine("Util").Collision=OBJECT({init:(e,t)=>{let n=(e,t,n)=>{return(t-e)*(n-e)<=0},i=t.checkPointInRect=((e,t,i,o,c,a,r,l,d,g)=>{e-=i,t-=o;let f=i+g*e+d*t,u=o-d*e+g*t;return c*=r,a*=l,i-=c/2,o-=a/2,n(f,i,i+c)===!0&&n(u,o,o+a)===!0}),o=t.checkPointInCircle=((e,t,n,i,o,c,a,r,l,d)=>{e-=n,t-=i,o*=a,c*=r;let g=2*(d*e+l*t)/o,f=2*(l*e-d*t)/c;return g*g+f*f<=1}),c=t.checkPointInPolygon=((e,t,n,i,o,c,a,r,l)=>{e-=n,t-=i;let d=n+l*e+r*t,g=i-r*e+l*t;d-=n,g-=i;let f=!1,u=o.length;for(let S=0,s=u-1;S<u;s=S,S+=1){let e=o[S].x*c,t=o[S].y*a,n=o[s].x*c,i=o[s].y*a;t>g!=i>g&&d<(n-e)*(g-t)/(i-t)+e&&(f=!f)}return f}),a=t.checkLineLine=((e,t,n,i,o,c,a,r,l,d,g,f,u,S,s,v,h,R,p,E)=>{n*=a,i*=r;let y=e+d*n+l*i,k=t+l*n+d*i;o*=a,c*=r;let m=e+d*o+l*c,C=t+l*o+d*c;u*=h,S*=R;let w=g+E*u+p*S,I=f+p*u+E*S;s*=h,v*=R;let Y=g+E*s+p*v,X=f+p*s+E*v,D=(m-y)*(X-I)-(Y-w)*(C-k);if(0===D)return!1;{let e=((X-I)*(Y-y)+(w-Y)*(X-k))/D,t=((k-C)*(Y-y)+(m-y)*(X-k))/D;return 0<=e&&e<=1&&0<=t&&t<=1}}),r=(t.checkLineRect=((e,t,n,o,c,r,l,d,g,f,u,S,s,v,h,R,p,E)=>{n*=l,o*=d;let y=e+f*n+g*o,k=t+g*n+f*o;if(i(y,k,u,S,s,v,h,R,p,E)===!0)return!0;c*=l,r*=d;
let m=e+f*c+g*r,C=t+g*c+f*r;if(i(m,C,u,S,s,v,h,R,p,E)===!0)return!0;let w,I,Y,X,D,T,x,A;s*=h/2,v*=R/2;let P=E*s,O=E*v,M=-p*s,H=-p*v;return w=u-P-H,I=S+M-O,Y=u+P-H,X=S-M-O,D=u+P+H,T=S-M+O,x=u-P+H,A=S+M+O,a(0,0,y,k,m,C,1,1,0,1,0,0,w,I,Y,X,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,Y,X,D,T,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,D,T,x,A,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,x,A,w,I,1,1,0,1)===!0}),t.checkLineCircle=((e,t,i,c,a,l,d,g,f,u,S,s,v,h,R,p,E,y)=>{i*=d,c*=g;let k=e+u*i+f*c,m=t+f*i+u*c;if(o(k,m,S,s,v,h,R,p,E,y)===!0)return!0;a*=d,l*=g;let C=e+u*a+f*l,w=t+f*a+u*l;if(o(C,w,S,s,v,h,R,p,E,y)===!0)return!0;k-=S,m-=s,C-=S,w-=s;let I=y*k+E*m,Y=-E*k+y*m,X=y*C+E*w,D=-E*C+y*w;v*=R,h*=p;let T=(D-Y)/(X-I);if(Math.abs(T)>1024)return r(0,0,Y,I,D,X,1,1,0,1,0,0,h,v,1,1,0,1);if(o(X,D,0,0,v,h,1,1,0,1)===!0)return!0;let x=v*v/4,A=h*h/4,P=Y-T*I,O=1/x+T*T/A,M=2*T*P/A,H=P*P/A-1,W=M*M-4*O*H;return!(W<0)&&(W=Math.sqrt(W),O*=2,n((-M-W)/O,I,X)===!0||n((-M+W)/O,I,X)===!0)})),l=(t.checkLinePolygon=((e,t,n,i,o,r,l,d,g,f,u,S,s,v,h,R,p)=>{n*=l,i*=d;let E=e+f*n+g*i,y=t+g*n+f*i;if(c(E,y,u,S,s,v,h,R,p)===!0)return!0;o*=l,r*=d;let k=e+f*o+g*r,m=t+g*o+f*r;if(c(k,m,u,S,s,v,h,R,p)===!0)return!0;let C=s.length;for(let w=0,I=C-1;w<C;I=w,w+=1){let e=s[w].x*v,t=s[w].y*h,n=s[I].x*v,i=s[I].y*h,o=u+p*e-R*t,c=S+R*e+p*t,r=u+p*n-R*i,l=S+R*n+p*i;if(a(0,0,E,y,k,m,1,1,0,1,0,0,o,c,r,l,1,1,0,1)===!0)return!0}return!1}),t.checkRectRect=((e,t,n,o,c,r,l,d,g,f,u,S,s,v,h,R)=>{n*=c,o*=r,u*=s,S*=v;let p,E,y,k,m,C,w,I,Y=d*n/2,X=d*o/2,D=-l*n/2,T=-l*o/2;if(p=e-Y-T,E=t+D-X,y=e+Y-T,k=t-D-X,m=e+Y+T,C=t-D+X,w=e-Y+T,I=t+D+X,i(p,E,g,f,u,S,1,1,h,R)===!0||i(y,k,g,f,u,S,1,1,h,R)===!0||i(m,C,g,f,u,S,1,1,h,R)===!0||i(w,I,g,f,u,S,1,1,h,R)===!0)return!0;let x,A,P,O,M,H,W,F,N=R*u/2,L=R*S/2,V=-h*u/2,b=-h*S/2;return x=g-N-b,A=f+V-L,P=g+N-b,O=f-V-L,M=g+N+b,H=f-V+L,W=g-N+b,F=f+V+L,i(x,A,e,t,n,o,1,1,l,d)===!0||i(P,O,e,t,n,o,1,1,l,d)===!0||i(M,H,e,t,n,o,1,1,l,d)===!0||i(W,F,e,t,n,o,1,1,l,d)===!0||(a(0,0,p,E,y,k,1,1,0,1,0,0,x,A,P,O,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,p,E,y,k,1,1,0,1,0,0,W,F,x,A,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,x,A,P,O,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,W,F,x,A,1,1,0,1)===!0||a(0,0,m,C,w,I,1,1,0,1,0,0,x,A,P,O,1,1,0,1)===!0||a(0,0,m,C,w,I,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,m,C,w,I,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,m,C,w,I,1,1,0,1,0,0,W,F,x,A,1,1,0,1)===!0||a(0,0,w,I,p,E,1,1,0,1,0,0,x,A,P,O,1,1,0,1)===!0||a(0,0,w,I,p,E,1,1,0,1,0,0,P,O,M,H,1,1,0,1)===!0||a(0,0,w,I,p,E,1,1,0,1,0,0,M,H,W,F,1,1,0,1)===!0||a(0,0,w,I,p,E,1,1,0,1,0,0,W,F,x,A,1,1,0,1)===!0)}),t.checkRectCircle=((e,t,n,c,a,l,d,g,f,u,S,s,v,h,R,p)=>{if(i(f,u,e,t,n,c,a,l,d,g)===!0)return!0;let E,y,k,m,C,w,I,Y;n*=a/2,c*=l/2;let X=g*n,D=g*c,T=-d*n,x=-d*c;return E=e-X-x,y=t+T-D,k=e+X-x,m=t-T-D,C=e+X+x,w=t-T+D,I=e-X+x,Y=t+T+D,o(E,y,f,u,S,s,v,h,R,p)===!0||o(k,m,f,u,S,s,v,h,R,p)===!0||o(C,w,f,u,S,s,v,h,R,p)===!0||o(I,Y,f,u,S,s,v,h,R,p)===!0||(S*=v,s*=h,r(0,0,E,y,k,m,1,1,0,1,f,u,S,s,1,1,R,p)===!0||r(0,0,k,m,C,w,1,1,0,1,f,u,S,s,1,1,R,p)===!0||r(0,0,C,w,I,Y,1,1,0,1,f,u,S,s,1,1,R,p)===!0||r(0,0,I,Y,E,y,1,1,0,1,f,u,S,s,1,1,R,p)===!0)}),t.checkRectPolygon=((e,t,n,o,r,l,d,g,f,u,S,s,v,h,R)=>{n*=r,o*=l;let p,E,y,k,m,C,w,I,Y=g*n/2,X=g*o/2,D=-d*n/2,T=-d*o/2;if(p=e-Y-T,E=t+D-X,y=e+Y-T,k=t-D-X,m=e+Y+T,C=t-D+X,w=e-Y+T,I=t+D+X,c(p,E,f,u,S,s,v,h,R)===!0||c(y,k,f,u,S,s,v,h,R)===!0||c(m,C,f,u,S,s,v,h,R)===!0||c(w,I,f,u,S,s,v,h,R)===!0)return!0;let x=S.length;for(let A=0,P=x-1;A<x;P=A,A+=1){let c=S[A].x*s,r=S[A].y*v,l=f+R*c-h*r,Y=u+h*c+R*r;if(i(l,Y,e,t,n,o,1,1,d,g)===!0)return!0;let X=S[P].x*s,D=S[P].y*v,T=f+R*X-h*D,x=u+h*X+R*D;if(a(0,0,p,E,y,k,1,1,0,1,0,0,l,Y,T,x,1,1,0,1)===!0||a(0,0,y,k,m,C,1,1,0,1,0,0,l,Y,T,x,1,1,0,1)===!0||a(0,0,m,C,w,I,1,1,0,1,0,0,l,Y,T,x,1,1,0,1)===!0||a(0,0,w,I,p,E,1,1,0,1,0,0,l,Y,T,x,1,1,0,1)===!0)return!0}return!1}),(e,t,n,i,o)=>{if(0===o)return!0;if(0===e)return 0!==t||(0!==n?i*i-4*n*o>=0:0!==i);let c=t/e,a=n/e,r=i/e,l=o/e,d=(8*a-3*c*c)/8,g=(c*c*c-4*c*a+8*r)/8,f=(-3*c*c*c*c+256*l-64*r*c+16*c*c*a)/256,u=256*f*f*f-128*d*d*f*f+144*d*g*g*f-27*g*g*g*g+16*d*d*d*d*f-4*d*d*d*g*g,S=8*d,s=64*f-16*d*d;return u<0||u>0&&S<0&&s<0||0===u&&(0!==s||S<=0)}),d=(e,t,n,i,o,c,a,r,d,g,f,u)=>{let S=(r/=a)-(t/=e),s=(d/=a)-(n/=e),v=(g/=a)-(i/=e),h=(f/=a)-(o/=e),R=(u/=a)-(c/=e);if(0===S&&0===v)return l(0,0,s,h,R);let p=t*d-r*n,E=t*f+i*d-r*o-g*n,y=t*u+i*f-r*c-g*o,k=i*u-g*c,m=s*s-p*S,C=2*s*h-S*E-v*p,w=h*h+2*s*R-S*y-v*E,I=2*h*R-v*y-S*k,Y=R*R-v*k;return l(m,C,w,I,Y)};t.checkCircleCircle=((e,t,n,i,c,a,r,l,g,f,u,S,s,v,h,R)=>{n*=c,i*=a,u*=s,S*=v,g-=e,f-=t,e=t=0;let p=((n>i?n:i)+(u>S?u:S))/2;if(g*g+f*f>p*p)return!1;if(o(g,f,e,t,n,i,1,1,r,l)===!0||o(e,t,g,f,u,S,1,1,h,R)===!0)return!0;let E=l*e+r*t,y=-r*e+l*t;r=-r;let k=n*n/4,m=i*i/4,C=l*l/k+r*r/m,w=-2*l*r/k+2*l*r/m,I=r*r/k+l*l/m,Y=-2*E*l/k-2*y*r/m,X=2*E*r/k-2*y*l/m,D=E*E/k+y*y/m-1;E=R*g+h*f,y=-h*g+R*f,h=-h,k=u*u/4,m=S*S/4;let T=R*R/k+h*h/m,x=-2*R*h/k+2*R*h/m,A=h*h/k+R*R/m,P=-2*E*R/k-2*y*h/m,O=2*E*h/k-2*y*R/m,M=E*E/k+y*y/m-1;return d(C,w,I,Y,X,D,T,x,A,P,O,M)&&d(I,w,C,X,Y,D,A,x,T,O,P,M)}),t.checkCirclePolygon=((e,t,n,i,a,l,d,g,f,u,S,s,v,h,R)=>{if(c(e,t,f,u,S,s,v,h,R)===!0)return!0;n*=a,i*=l;let p=S.length;for(let E=0,y=p-1;E<p;y=E,E+=1){let c=S[E].x*s,a=S[E].y*v,l=f+R*c-h*a,p=u+h*c+R*a;if(o(l,p,e,t,n,i,1,1,d,g)===!0)return!0;let k=S[y].x*s,m=S[y].y*v,C=f+R*k-h*m,w=u+h*k+R*m;if(r(0,0,l,p,C,w,1,1,0,1,e,t,n,i,1,1,d,g)===!0)return!0}return!1}),t.checkPolygonPolygon=((e,t,n,i,o,r,l,d,g,f,u,S,s,v)=>{let h=n.length,R=f.length;for(let p=0,E=R-1;p<R;E=p,p+=1){let a=f[p].x*u,h=f[p].y*S,R=d+v*a-s*h,E=g+s*a+v*h;if(c(R,E,e,t,n,i,o,r,l)===!0)return!0}for(let p=0,E=h-1;p<h;E=p,p+=1){let h=n[p].x*i,y=n[p].y*o,k=e+l*h-r*y,m=t+r*h+l*y;if(c(k,m,d,g,f,u,S,s,v)===!0)return!0;let C=n[E].x*i,w=n[E].y*o,I=e+l*C-r*w,Y=t+r*C+l*w;for(let X=0,D=R-1;X<R;D=X,X+=1){let e=f[X].x*u,t=f[X].y*S,n=d+v*e-s*t,i=g+s*e+v*t,o=f[D].x*u,c=f[D].y*S,r=d+v*o-s*c,l=g+s*o+v*c;if(a(0,0,k,m,I,Y,1,1,0,1,0,0,n,i,r,l,1,1,0,1)===!0)return!0}}return!1})}}),SkyEngine("Util").ImageData=OBJECT({init:(e,t)=>{const n=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1],i=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0];let o=t.checkImageDataPointIsTransparent=((e,t,n,i)=>{return e[4*(i*t+n)+3]<=20});t.convertImageDataToPolygonPoints=((e,t)=>{let c,a,r,l,d=0,g=0,f=[];for(;;){if(o(e,t,d,g)!==!0){r=d,l=g;break}0===d?(d=g+1,g=0):(d-=1,g+=1)}d=r,g=l;let u=0,S=0;do{let r=0;if(o(e,t,d-1,g-1)!==!0&&(r+=1),o(e,t,d,g-1)!==!0&&(r+=2),o(e,t,d-1,g)!==!0&&(r+=4),o(e,t,d,g)!==!0&&(r+=8),6===r)u=a===-1?-1:1,S=0;else if(9===r)u=0,S=1===c?-1:1;else{if(!(r<15))break;u=n[r],S=i[r]}if(u!==c&&S!==a&&(f.push({x:d,y:g}),c=u,a=S),d+=u,g+=S,d<0||g<0)break}while(r!==d||l!==g);return f})}});